{"ast":null,"code":"import _Promise from \"@babel/runtime-corejs2/core-js/promise\";\nimport _defineProperty from \"@babel/runtime-corejs2/helpers/esm/defineProperty\";\nvar _jsxFileName = \"/Users/wolf/Documents/clearchoice/admin/feature-view-updated-course/clear-choice-admin/components/Student/DetailLessonList/index.js\";\nvar __jsx = React.createElement;\n\n/* eslint-disable react/no-did-mount-set-state */\n\n/* eslint-disable react/no-did-update-set-state */\n\n/* eslint-disable react/no-array-index-key */\nimport { connect } from \"react-redux\";\nimport { bindActionCreators } from \"redux\";\nimport React from \"react\";\nimport PropTypes from \"prop-types\";\nimport update from \"immutability-helper\";\nimport moment from \"moment\";\nimport FilterSection from \"./components/FilterSection\";\nimport FullView from \"./components/FullView\";\nimport { dueDateAscending, subjectAscending, subjectDescending, passageAscending, passageDescending, lessonNameDescending, lessonNameAscending, statusDescending, statusAscending, scoreDescending, scoreAscending, availableDateAscending, availableDateDescending, dueDate, flagsAscending, flagsDescending, completionDateAscending, completionDateDescending, lessonTypeAscending, lessonTypeDescending } from \"../../utils/sortFunctions\";\nimport ListView from \"./components/ListView\";\nimport LessonDetailAnswerSheet from \"../LessonDetailAnswerSheet\";\nimport AssignLessonModal from \"./components/AssignLessonModal\";\nimport { renderDropdownOptions } from './components/FullView/components/LessonCard/utils/index';\nimport ReadWorkBook from '../ReadWorkBook';\nimport Modal from \"../../Modal/index\";\nimport { getLessonList, getStudentLessonList, checkLesson, checkAllLessons, unCheckAllLessons, addCheckedLesson, removeCheckedLesson, assignLessonToStudent, addAllLessons, removeAllLessons, excuseStudentLateness, filterLessons, flagStudentLessonProblem } from \"../index/actions\";\nimport { makeSelectGetLessonList, makeSelectCheckedLessons, makeSelectActiveStudentToken, makeSelectGetStudentLessonList, makeSelectActiveLesson, makeSelectOpenActivePage, makeSelectSubjects } from \"../index/selectors\";\nimport { createStructuredSelector } from \"reselect\";\nimport AssignDatesModal from \"./components/AssignDatesModal\";\nimport { setOpenActivePage, setIsVisibleTopBar } from \"../index/actions\";\nimport { fetchStudentLessonSectionApi } from \"../index/api\";\nimport { mergeArrays } from './utils/mergeArrays'; // TODO: compare updatedlessons to lessons and update lesson list\n\nclass DetailLessonList extends React.Component {\n  constructor(props) {\n    super(props);\n\n    _defineProperty(this, \"componentWillReceiveProps\", nextProps => {\n      if (this.state.lessons.length === 0) {\n        this.setState({\n          lessons: nextProps.lessonList\n        });\n      }\n    });\n\n    _defineProperty(this, \"onCheckAllClicked\", async checked => {\n      const selectedLessonIds = this.getMappableLessons().map(lesson => lesson.id);\n\n      if (!checked) {\n        await this.props.dispatchCheckAllLesson(selectedLessonIds);\n        await this.props.dispatchAddAllLessons(this.getMappableLessons());\n        this.setState({\n          selectAll: !checked\n        });\n      } else {\n        await this.props.dispatchUnCheckAllLesson(selectedLessonIds);\n        await this.props.dispatchRemoveAllLessons(this.getMappableLessons());\n        this.setState({\n          selectAll: false\n        });\n      }\n\n      this.setCheckedCardIds();\n    });\n\n    _defineProperty(this, \"onAddCheckedLesson\", async (lessonId, uniqueId) => {\n      await this.props.dispatchAddCheckedLesson(lessonId);\n      await this.props.dispathCheckLesson(uniqueId);\n      this.setCheckedCardIds();\n\n      if (!this.state.selectAll) {\n        this.setState({\n          selectAll: true\n        });\n      }\n    });\n\n    _defineProperty(this, \"onRemoveCheckedLesson\", async (lessonId, uniqueId) => {\n      await this.props.dispatchRemoveCheckedLesson(lessonId);\n      await this.props.dispathCheckLesson(uniqueId);\n      this.setCheckedCardIds();\n\n      if (this.props.checkedLessons.length === 0) {\n        this.setState({\n          selectAll: false\n        });\n      }\n    });\n\n    _defineProperty(this, \"setCheckedCardIds\", () => {\n      this.setState({\n        checkedCardIds: this.props.lessonList.filter(lesson => lesson.selected && lesson.lesson_id).map(lesson => lesson.id)\n      });\n    });\n\n    _defineProperty(this, \"onOpenModal\", () => this.setState({\n      modalOpen: true\n    }));\n\n    _defineProperty(this, \"onCloseModal\", () => this.setState({\n      modalOpen: false\n    }));\n\n    _defineProperty(this, \"onOpenDropdown\", () => this.setState({\n      dropdownIsOpen: true\n    }));\n\n    _defineProperty(this, \"onCloseDropdown\", () => this.setState({\n      dropdownIsOpen: false\n    }));\n\n    _defineProperty(this, \"onOpenConfirmModal\", () => this.setState({\n      isConfirmModalOpen: true\n    }));\n\n    _defineProperty(this, \"onCloseConfirmModal\", () => this.setState({\n      isConfirmModalOpen: false\n    }));\n\n    _defineProperty(this, \"onClearFilters\", () => this.setState({\n      subjectFilters: [],\n      completeFilters: [],\n      flagFilters: [],\n      dueDateFilters: [],\n      unitFilter: \"\",\n      nameFilter: \"\"\n    }));\n\n    _defineProperty(this, \"onSetSort\", sort => this.setState({\n      sort\n    }));\n\n    _defineProperty(this, \"onSetFilteredState\", lesson => this.setState({\n      nameFilter: lesson\n    }));\n\n    _defineProperty(this, \"onUnsetFilteredState\", filter => this.setState({\n      [filter]: \"\"\n    }));\n\n    _defineProperty(this, \"onChangeView\", view => this.setState({\n      currentView: view,\n      active: view\n    }));\n\n    _defineProperty(this, \"onSetUnitFilter\", unit => {\n      this.setState({\n        unitFilter: unit\n      });\n    });\n\n    _defineProperty(this, \"onSortLessons\", lessons => {\n      const {\n        sort\n      } = this.state;\n\n      switch (sort) {\n        case \"subjectAscending\":\n          return lessons.sort(subjectAscending);\n\n        case \"subjectDescending\":\n          return lessons.sort(subjectDescending);\n\n        case \"passageAscending\":\n          return lessons.sort(passageAscending);\n\n        case \"statusAscending\":\n          return lessons.sort(statusAscending);\n\n        case \"scoreAscending\":\n          return lessons.sort(scoreAscending);\n\n        case \"passageDescending\":\n          return lessons.sort(passageDescending);\n\n        case \"statusDescending\":\n          return lessons.sort(statusDescending);\n\n        case \"scoreDescending\":\n          return lessons.sort(scoreDescending);\n\n        case \"availableDateAscending\":\n          return lessons.sort(availableDateAscending);\n\n        case \"availableDateDescending\":\n          return lessons.sort(availableDateDescending);\n\n        case \"dueDateDescending\":\n          return lessons.sort(dueDate);\n\n        case \"dueDateAscending\":\n          return lessons.sort(dueDateAscending);\n\n        case \"flagsAscending\":\n          return lessons.sort(flagsAscending);\n\n        case \"flagsDescending\":\n          return lessons.sort(flagsDescending);\n\n        case \"lessonNameAscending\":\n          return lessons.sort(lessonNameAscending);\n\n        case \"lessonNameDescending\":\n          return lessons.sort(lessonNameDescending);\n\n        case \"completionDateAscending\":\n          return lessons.sort(completionDateAscending);\n\n        case \"completionDateDescending\":\n          return lessons.sort(completionDateDescending);\n\n        case \"lessonTypeAscending\":\n          return lessons.sort(lessonTypeAscending);\n\n        case \"lessonTypeDescending\":\n          return lessons.sort(lessonTypeDescending);\n\n        case \"dueDate\":\n          return lessons.sort(dueDateAscending);\n\n        default:\n          break;\n      }\n    });\n\n    _defineProperty(this, \"onAddUpdatedLessons\", lessons => this.setState({\n      updatedLessons: lessons\n    }));\n\n    _defineProperty(this, \"onFilterByName\", mappableLessons => {\n      const {\n        nameFilter\n      } = this.state;\n      return mappableLessons.reduce((finalArr, currentLesson) => {\n        const {\n          name\n        } = currentLesson;\n        const lessonString = name.replace(/\\s/g, \"\").toLowerCase();\n\n        if (lessonString.indexOf(nameFilter.toLowerCase().replace(/\\s/g, '')) !== -1 && finalArr.indexOf(currentLesson) === -1) {\n          finalArr.push(currentLesson);\n        }\n\n        return finalArr;\n      }, []);\n    });\n\n    _defineProperty(this, \"onCloneLesson\", index => {\n      const {\n        lessons\n      } = this.state;\n      this.setState(prevState => {\n        prevState.lessons.push(lessons[index]);\n        return {\n          lessons: prevState.lessons\n        };\n      });\n    });\n\n    _defineProperty(this, \"onDeleteLesson\", index => {\n      const {\n        lessons\n      } = this.state;\n      const newLessonsArray = this.arrayItemRemover(lessons, lessons[index]);\n      this.setState({\n        lessons: newLessonsArray\n      });\n    });\n\n    _defineProperty(this, \"onFilterLessons\", mappableLessons => {\n      const {\n        subjectFilters,\n        unitFilter,\n        scoreStatusFilters,\n        flagFilters\n      } = this.state;\n      const {\n        subjects\n      } = this.props;\n      let lessons = [];\n\n      if (scoreStatusFilters.length && scoreStatusFilters.indexOf(\"all\") === -1) {\n        lessons = mappableLessons.filter(lesson => lesson.scoring && lesson.scoring.grade && scoreStatusFilters.indexOf(lesson.scoring.grade.toLowerCase()) !== -1);\n      }\n\n      if (subjectFilters.length && subjectFilters.indexOf(\"all\") === -1) {\n        lessons = mappableLessons.filter(lesson => {\n          if (!lesson.subjects) {\n            return subjectFilters.indexOf(subjects[lesson.subject_id]) !== -1;\n          }\n\n          return subjectFilters.indexOf(lesson.subjects.name) !== -1;\n        });\n      }\n\n      if (flagFilters.length && flagFilters.indexOf(\"all\") === -1) {\n        lessons = lessons.filter(lesson => lesson.problems && lesson.problems.filter(problem => problem.flat_status).length !== 0);\n      }\n\n      if (unitFilter.length && unitFilter.indexOf(\"all\") === -1) {\n        lessons = mappableLessons.filter(lesson => {\n          if (!lesson.units) {\n            return unitFilter.indexOf(lesson.unit_id) !== -1;\n          }\n\n          return unitFilter.indexOf(lesson.units.id) !== -1;\n        });\n      }\n\n      return lessons;\n    });\n\n    _defineProperty(this, \"getMappableLessons\", () => {\n      const {\n        sort,\n        unitFilter,\n        dueDateFilters,\n        nameFilter,\n        subjectFilters,\n        scoreStatusFilters,\n        flagFilters,\n        prevFilters\n      } = this.state;\n\n      if (unitFilter !== prevFilters.unitFilter || nameFilter !== prevFilters.nameFilter) {\n        const {\n          dispatchFilterLessons\n        } = this.props;\n        this.setState({\n          prevFilters: {\n            unitFilter,\n            nameFilter\n          }\n        });\n        dispatchFilterLessons({\n          unitFilter,\n          nameFilter\n        });\n      }\n\n      let mappableLessons = this.props.lessonList;\n\n      if (nameFilter.length) {\n        mappableLessons = this.onFilterByName(mappableLessons);\n      }\n\n      if (unitFilter.length || scoreStatusFilters.length || subjectFilters.length || flagFilters.length) {\n        mappableLessons = this.onFilterLessons(mappableLessons);\n      }\n\n      if (dueDateFilters.length) {\n        mappableLessons = this.filterDueDate(mappableLessons);\n      }\n\n      if (sort) {\n        return [...this.onSortLessons(mappableLessons)];\n      }\n\n      return mappableLessons;\n    });\n\n    _defineProperty(this, \"filterDueDate\", mappableLessons => {\n      const {\n        user\n      } = this.props;\n      const {\n        dueDateFilters\n      } = this.state;\n      let lessons = mappableLessons;\n\n      if (dueDateFilters.length && dueDateFilters.indexOf(\"all\") === -1) {\n        if (dueDateFilters.includes(\"dueToday\")) {\n          lessons = lessons.filter(lesson => lesson.due_date === moment().format(\"YYYY-MM-DD\"));\n        }\n\n        if (dueDateFilters.includes(\"dueNextSession\")) {\n          lessons = lessons.filter(lesson => moment(user.nextSession).isSameOrAfter(lesson.dueDate, \"day\"));\n        }\n\n        if (dueDateFilters.includes(\"overdue\")) {\n          lessons = lessons.filter(lesson => lesson.status === 'OVERDUE');\n        }\n\n        if (dueDateFilters.includes(\"noDueDate\")) {\n          lessons = lessons.filter(lesson => !lesson.due_date);\n        }\n\n        if (dueDateFilters.includes(\"unAssigned\")) {\n          lessons = lessons.filter(lesson => lesson.status === \"NOTASSIGNED\");\n        }\n\n        return lessons;\n      }\n\n      return lessons;\n    });\n\n    _defineProperty(this, \"handleFilterClick\", (filterType, filter) => {\n      const {\n        subjectFilters: currentSubjectFilters,\n        scoreStatusFilters: currentScoreStatusFilters,\n        flagFilters: currentFlagFilters,\n        dueDateFilters: currentDueDateFilters\n      } = this.state;\n      let modifiedFilterCurrentState;\n      let modifiedFilterName;\n      let modifiedFilterUpdatedState;\n\n      switch (filterType) {\n        case \"subject\":\n          modifiedFilterCurrentState = currentSubjectFilters;\n          modifiedFilterName = \"subjectFilters\";\n          break;\n\n        case \"score\":\n          modifiedFilterCurrentState = currentScoreStatusFilters;\n          modifiedFilterName = \"scoreStatusFilters\";\n          break;\n\n        case \"flags\":\n          modifiedFilterCurrentState = currentFlagFilters;\n          modifiedFilterName = \"flagFilters\";\n          break;\n\n        case \"dueDate\":\n          modifiedFilterCurrentState = currentDueDateFilters;\n          modifiedFilterName = \"dueDateFilters\";\n          break;\n\n        default:\n          break;\n      } // Decide whether we're adding or removing the selected filter\n\n\n      if (modifiedFilterCurrentState.indexOf(filter) === -1) {\n        modifiedFilterUpdatedState = update(modifiedFilterCurrentState, {\n          $push: [filter]\n        });\n      } else {\n        const filterIndex = modifiedFilterCurrentState.indexOf(filter);\n        modifiedFilterUpdatedState = update(modifiedFilterCurrentState, {\n          $splice: [[filterIndex, 1]]\n        });\n      }\n\n      this.setState({\n        [modifiedFilterName]: modifiedFilterUpdatedState\n      });\n    });\n\n    _defineProperty(this, \"arrayItemRemover\", (array, value) => array.filter(lesson => lesson !== value));\n\n    _defineProperty(this, \"renderCurrentView\", () => {\n      const {\n        active\n      } = this.state;\n      const {\n        user\n      } = this.props;\n\n      if (active === \"full\") {\n        return __jsx(FullView, {\n          user: user,\n          lessons: this.getMappableLessons(),\n          selectAll: this.state.selectAll,\n          onDeleteLesson: this.onDeleteLesson,\n          onCloneLesson: this.onCloneLesson,\n          onCheckAll: this.onCheckAllClicked,\n          onAddCheckedLesson: this.onAddCheckedLesson,\n          onRemoveCheckedLesson: this.onRemoveCheckedLesson,\n          dropdownIsOpen: this.state.dropdownIsOpen,\n          onOpenModal: this.onOpenModal,\n          onCloseDropdown: this.onCloseDropdown,\n          onOpenDropdown: this.onOpenDropdown,\n          renderDropdownOptions: renderDropdownOptions,\n          checkedCardIds: this.state.checkedCardIds,\n          onAddAssignLessonIds: this.onAddAssignLessonIds,\n          resetLessonSelections: this.resetLessonSelections,\n          handleMarkAllFlagsReviewed: this.handleMarkAllFlagsReviewed,\n          lessonIdsToUnFlag: this.state.lessonIdsToUnFlag,\n          handleExcuseLessonLateness: this.handleExcuseLessonLateness,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 438\n          },\n          __self: this\n        });\n      }\n\n      return __jsx(ListView, {\n        user: user,\n        lessons: this.getMappableLessons(),\n        onSetSort: this.onSetSort,\n        sort: this.state.sort,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 462\n        },\n        __self: this\n      });\n    });\n\n    _defineProperty(this, \"onAssignLesson\", lessonDates => {\n      const {\n        checkedLessons,\n        studentLess\n      } = this.props; // Check if there are lessons to assign\n\n      if (checkedLessons.length <= 0) return null; // Check if that lesson has already been assigned\n\n      const payload = {\n        student_id: this.props.user.id,\n        lesson_ids: checkedLessons,\n        assignment_date: lessonDates.assignDate,\n        due_date: lessonDates.dueDate\n      };\n      const prevAssignedLessons = studentLess.filter(lesson => checkedLessons.includes(lesson.lesson_id)); // If lessons have been assigned before, open modal\n\n      if (prevAssignedLessons.length > 0) {\n        this.onOpenConfirmModal();\n        return this.setState({\n          prevAssignedLessons,\n          lessonsToAssign: payload,\n          confirmationModalMessage: 'One or more lessons you are assigning to this student have previously been assigned. Assign Lessons anyways?'\n        });\n      } // Move onto sending request\n\n\n      this.submitAssignedLesson(payload);\n    });\n\n    _defineProperty(this, \"submitAssignedLesson\", lessons => {\n      const {\n        dispatchAssignLessonToStudent\n      } = this.props;\n      this.onCloseConfirmModal(); // Dispatch assign lesson to student\n\n      let payload = lessons;\n\n      if (!payload) {\n        payload = this.state.lessonsToAssign;\n      }\n\n      dispatchAssignLessonToStudent(payload); // Clear the redux checkedLesson property\n\n      this.resetLessonSelections();\n    });\n\n    _defineProperty(this, \"resetLessonSelections\", () => {\n      const {\n        dispatchRemoveAllLessons,\n        dispatchUnCheckAllLesson\n      } = this.props;\n      dispatchUnCheckAllLesson(this.getMappableLessons());\n      dispatchRemoveAllLessons(this.getMappableLessons());\n      this.setState({\n        selectAll: false,\n        prevAssignedLessons: [],\n        lessonsToAssign: {}\n      });\n    });\n\n    _defineProperty(this, \"onCloseDetailModal\", () => {\n      const {\n        onSetOpenActivePage,\n        onSetIsVisibleTopBar\n      } = this.props;\n      onSetIsVisibleTopBar(true);\n      onSetOpenActivePage(\"\");\n    });\n\n    _defineProperty(this, \"handleMarkAllFlagsReviewed\", studentLessonIds => {\n      const {\n        onFlagStudentLessonProblem\n      } = this.props;\n\n      if (studentLessonIds && studentLessonIds.length > 0) {\n        this.getMappableLessons().forEach(lesson => {\n          if (studentLessonIds.includes(lesson.id)) {\n            if (lesson.problems && lesson.problems.length > 0) {\n              lesson.problems.forEach(problem => {\n                if (problem.flag_status === \"FLAGGED\") {\n                  const payload = {\n                    student_lesson_id: lesson.id,\n                    problem_id: problem.problem.id,\n                    flag_status: 'REVIEWED'\n                  };\n                  onFlagStudentLessonProblem(payload);\n                }\n              });\n            } else if (lesson.sections && lesson.sections.length > 0) {\n              const section1 = fetchStudentLessonSectionApi(this.props.user.id, lesson.id, lesson.sections[0].id);\n              const section2 = fetchStudentLessonSectionApi(this.props.user.id, lesson.id, lesson.sections[1].id);\n\n              _Promise.all([section1, section2]).then(sections => {\n                const filteredSections = sections.filter(section => section);\n                filteredSections.map(section => {\n                  section.lesson_problems.map(problem => {\n                    if (problem.flag_status === \"FLAGGED\") {\n                      const payload = {\n                        student_lesson_id: lesson.id,\n                        problem_id: problem.problem.id,\n                        flag_status: 'REVIEWED'\n                      };\n                      onFlagStudentLessonProblem(payload);\n                    }\n                  });\n                });\n              });\n            }\n          }\n        });\n        this.setState({\n          lessonIdsToUnFlag: mergeArrays(this.state.lessonIdsToUnFlag, studentLessonIds)\n        });\n        this.resetLessonSelections();\n      }\n    });\n\n    _defineProperty(this, \"handleExcuseLessonLateness\", lessonCardIds => {\n      const {\n        onExcuseStudentLateness\n      } = this.props;\n\n      if (lessonCardIds && lessonCardIds.length > 0) {\n        this.getMappableLessons().forEach(lesson => {\n          if (lessonCardIds.includes(lesson.id)) {\n            const payload = {\n              student_lesson_id: lesson.id,\n              was_excused: !lesson.lateness_excused\n            };\n            onExcuseStudentLateness(payload);\n          }\n        }); // Deselect all checks and lessons\n\n        this.resetLessonSelections();\n      }\n    });\n\n    this.state = {\n      test: true,\n      lessons: [],\n      modalOpen: false,\n      currentView: \"full\",\n      active: \"full\",\n      subjectFilters: [],\n      scoreStatusFilters: [],\n      flagFilters: [],\n      dueDateFilters: [],\n      sort: \"\",\n      nameFilter: \"\",\n      unitFilter: \"\",\n      updatedLessons: [],\n      selectAll: false,\n      dropdownIsOpen: false,\n      checkedCardIds: [],\n      isConfirmModalOpen: false,\n      prevAssignedLessons: [],\n      lessonsToAssign: {},\n      prevFilters: {\n        nameFilter: '',\n        unitFilter: ''\n      },\n      confirmationModalMessage: '',\n      lessonIdsToUnFlag: []\n    };\n  }\n\n  componentDidMount() {\n    this.props.dispathGetLessonList();\n    const {\n      id\n    } = this.props.user;\n    const {\n      studentToken\n    } = this.props;\n    const postBody = {\n      id,\n      studentToken\n    };\n    this.props.dispathGetStudentLessonList(postBody);\n  }\n\n  confirmationModal() {\n    return __jsx(Modal, {\n      open: this.state.isConfirmModalOpen,\n      onConfirm: () => this.submitAssignedLesson(),\n      onClose: this.onCloseConfirmModal,\n      header: \"Are you sure?\",\n      body: this.state.confirmationModalMessage,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 527\n      },\n      __self: this\n    });\n  }\n\n  render() {\n    const {\n      currentView,\n      subjectFilters,\n      scoreStatusFilters,\n      flagFilters,\n      dueDateFilters\n    } = this.state;\n    const {\n      activeShowPage\n    } = this.props;\n    return __jsx(React.Fragment, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 623\n      },\n      __self: this\n    }, this.confirmationModal(), activeShowPage === \"AnswerSheet\" ? __jsx(LessonDetailAnswerSheet, {\n      onCloseDetailModal: this.onCloseDetailModal,\n      user: this.props.user,\n      lesson: this.props.activeLesson,\n      onOpenModal: this.onOpenModal,\n      onAddCheckedLesson: this.onAddCheckedLesson,\n      onCloseDropdown: this.onCloseDropdown,\n      resetLessonSelections: this.resetLessonSelections,\n      handleMarkAllFlagsReviewed: this.handleMarkAllFlagsReviewed,\n      lessonIdsToUnFlag: this.state.lessonIdsToUnFlag,\n      handleExcuseLessonLateness: this.handleExcuseLessonLateness,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 627\n      },\n      __self: this\n    }) : activeShowPage === \"ReadWorkBook\" ? __jsx(ReadWorkBook, {\n      onCloseDetailModal: this.onCloseDetailModal,\n      user: this.props.user,\n      lesson: this.props.activeLesson,\n      onOpenModal: this.onOpenModal,\n      onAddCheckedLesson: this.onAddCheckedLesson,\n      onCloseDropdown: this.onCloseDropdown,\n      resetLessonSelections: this.resetLessonSelections,\n      handleMarkAllFlagsReviewed: this.handleMarkAllFlagsReviewed,\n      handleExcuseLessonLateness: this.handleExcuseLessonLateness,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 641\n      },\n      __self: this\n    }) : [__jsx(FilterSection, {\n      currentView: currentView,\n      onChangeView: this.onChangeView,\n      onClearFilters: this.onClearFilters,\n      onSetFilteredState: this.onSetFilteredState,\n      onUnsetFilteredState: this.onUnsetFilteredState,\n      onSetSort: this.onSetSort,\n      subjectFilters: subjectFilters,\n      scoreStatusFilters: scoreStatusFilters,\n      flagFilters: flagFilters,\n      dueDateFilters: dueDateFilters,\n      handleFilterClick: this.handleFilterClick,\n      onSetUnitFilter: this.onSetUnitFilter,\n      filterDueDate: this.filterDueDate,\n      key: \"0\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 654\n      },\n      __self: this\n    }), this.renderCurrentView(), __jsx(AssignDatesModal, {\n      open: this.state.modalOpen // lessons={this.props.user.lessons}\n      ,\n      lessons: this.props.lessonList,\n      onCloseDatesModal: this.onCloseModal,\n      onAddUpdatedLessons: this.onAddUpdatedLessons,\n      onAssignLesson: this.onAssignLesson.bind(this),\n      key: \"2\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 670\n      },\n      __self: this\n    }), __jsx(\"a\", {\n      href: \"#\",\n      onClick: this.onOpenModal,\n      className: \"waves-effect waves-teal btn add-btn modal-trigger\",\n      key: \"3\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 678\n      },\n      __self: this\n    }, __jsx(\"i\", {\n      className: \"material-icons\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 683\n      },\n      __self: this\n    }, \"add\"), \"Assign Lesson\")]);\n  }\n\n}\n\nDetailLessonList.propTypes = {\n  user: PropTypes.object.isRequired,\n  activeLesson: PropTypes.object,\n  openAnswerSheetStatus: PropTypes.bool.isRequired\n};\n\nconst mapDispatchToProps = dispatch => ({\n  dispathGetLessonList: bindActionCreators(getLessonList, dispatch),\n  dispathGetStudentLessonList: bindActionCreators(getStudentLessonList, dispatch),\n  dispathCheckLesson: bindActionCreators(checkLesson, dispatch),\n  dispatchCheckAllLesson: bindActionCreators(checkAllLessons, dispatch),\n  dispatchUnCheckAllLesson: bindActionCreators(unCheckAllLessons, dispatch),\n  dispatchAddCheckedLesson: bindActionCreators(addCheckedLesson, dispatch),\n  dispatchRemoveCheckedLesson: bindActionCreators(removeCheckedLesson, dispatch),\n  dispatchAssignLessonToStudent: bindActionCreators(assignLessonToStudent, dispatch),\n  dispatchAddAllLessons: bindActionCreators(addAllLessons, dispatch),\n  dispatchRemoveAllLessons: bindActionCreators(removeAllLessons, dispatch),\n  onSetOpenActivePage: bindActionCreators(setOpenActivePage, dispatch),\n  onSetIsVisibleTopBar: bindActionCreators(setIsVisibleTopBar, dispatch),\n  onExcuseStudentLateness: bindActionCreators(excuseStudentLateness, dispatch),\n  dispatchFilterLessons: bindActionCreators(filterLessons, dispatch),\n  onFlagStudentLessonProblem: bindActionCreators(flagStudentLessonProblem, dispatch)\n});\n\nconst mapStateToProps = createStructuredSelector({\n  lessonList: makeSelectGetLessonList(),\n  studentLess: makeSelectGetStudentLessonList(),\n  checkedLessons: makeSelectCheckedLessons(),\n  studentToken: makeSelectActiveStudentToken(),\n  activeLesson: makeSelectActiveLesson(),\n  activeShowPage: makeSelectOpenActivePage(),\n  subjects: makeSelectSubjects()\n});\nexport default connect(mapStateToProps, mapDispatchToProps)(DetailLessonList);","map":{"version":3,"sources":["/Users/wolf/Documents/clearchoice/admin/feature-view-updated-course/clear-choice-admin/components/Student/DetailLessonList/index.js"],"names":["connect","bindActionCreators","React","PropTypes","update","moment","FilterSection","FullView","dueDateAscending","subjectAscending","subjectDescending","passageAscending","passageDescending","lessonNameDescending","lessonNameAscending","statusDescending","statusAscending","scoreDescending","scoreAscending","availableDateAscending","availableDateDescending","dueDate","flagsAscending","flagsDescending","completionDateAscending","completionDateDescending","lessonTypeAscending","lessonTypeDescending","ListView","LessonDetailAnswerSheet","AssignLessonModal","renderDropdownOptions","ReadWorkBook","Modal","getLessonList","getStudentLessonList","checkLesson","checkAllLessons","unCheckAllLessons","addCheckedLesson","removeCheckedLesson","assignLessonToStudent","addAllLessons","removeAllLessons","excuseStudentLateness","filterLessons","flagStudentLessonProblem","makeSelectGetLessonList","makeSelectCheckedLessons","makeSelectActiveStudentToken","makeSelectGetStudentLessonList","makeSelectActiveLesson","makeSelectOpenActivePage","makeSelectSubjects","createStructuredSelector","AssignDatesModal","setOpenActivePage","setIsVisibleTopBar","fetchStudentLessonSectionApi","mergeArrays","DetailLessonList","Component","constructor","props","nextProps","state","lessons","length","setState","lessonList","checked","selectedLessonIds","getMappableLessons","map","lesson","id","dispatchCheckAllLesson","dispatchAddAllLessons","selectAll","dispatchUnCheckAllLesson","dispatchRemoveAllLessons","setCheckedCardIds","lessonId","uniqueId","dispatchAddCheckedLesson","dispathCheckLesson","dispatchRemoveCheckedLesson","checkedLessons","checkedCardIds","filter","selected","lesson_id","modalOpen","dropdownIsOpen","isConfirmModalOpen","subjectFilters","completeFilters","flagFilters","dueDateFilters","unitFilter","nameFilter","sort","view","currentView","active","unit","updatedLessons","mappableLessons","reduce","finalArr","currentLesson","name","lessonString","replace","toLowerCase","indexOf","push","index","prevState","newLessonsArray","arrayItemRemover","scoreStatusFilters","subjects","scoring","grade","subject_id","problems","problem","flat_status","units","unit_id","prevFilters","dispatchFilterLessons","onFilterByName","onFilterLessons","filterDueDate","onSortLessons","user","includes","due_date","format","nextSession","isSameOrAfter","status","filterType","currentSubjectFilters","currentScoreStatusFilters","currentFlagFilters","currentDueDateFilters","modifiedFilterCurrentState","modifiedFilterName","modifiedFilterUpdatedState","$push","filterIndex","$splice","array","value","onDeleteLesson","onCloneLesson","onCheckAllClicked","onAddCheckedLesson","onRemoveCheckedLesson","onOpenModal","onCloseDropdown","onOpenDropdown","onAddAssignLessonIds","resetLessonSelections","handleMarkAllFlagsReviewed","lessonIdsToUnFlag","handleExcuseLessonLateness","onSetSort","lessonDates","studentLess","payload","student_id","lesson_ids","assignment_date","assignDate","prevAssignedLessons","onOpenConfirmModal","lessonsToAssign","confirmationModalMessage","submitAssignedLesson","dispatchAssignLessonToStudent","onCloseConfirmModal","onSetOpenActivePage","onSetIsVisibleTopBar","studentLessonIds","onFlagStudentLessonProblem","forEach","flag_status","student_lesson_id","problem_id","sections","section1","section2","all","then","filteredSections","section","lesson_problems","lessonCardIds","onExcuseStudentLateness","was_excused","lateness_excused","test","componentDidMount","dispathGetLessonList","studentToken","postBody","dispathGetStudentLessonList","confirmationModal","render","activeShowPage","onCloseDetailModal","activeLesson","onChangeView","onClearFilters","onSetFilteredState","onUnsetFilteredState","handleFilterClick","onSetUnitFilter","renderCurrentView","onCloseModal","onAddUpdatedLessons","onAssignLesson","bind","propTypes","object","isRequired","openAnswerSheetStatus","bool","mapDispatchToProps","dispatch","mapStateToProps"],"mappings":";;;;;AAAA;;AACA;;AACA;AACA,SAASA,OAAT,QAAwB,aAAxB;AACA,SAASC,kBAAT,QAAmC,OAAnC;AAEA,OAAOC,KAAP,MAAkB,OAAlB;AACA,OAAOC,SAAP,MAAsB,YAAtB;AACA,OAAOC,MAAP,MAAmB,qBAAnB;AACA,OAAOC,MAAP,MAAmB,QAAnB;AACA,OAAOC,aAAP,MAA0B,4BAA1B;AACA,OAAOC,QAAP,MAAqB,uBAArB;AACA,SACEC,gBADF,EAEEC,gBAFF,EAGEC,iBAHF,EAIEC,gBAJF,EAKEC,iBALF,EAMEC,oBANF,EAOEC,mBAPF,EAQEC,gBARF,EASEC,eATF,EAUEC,eAVF,EAWEC,cAXF,EAYEC,sBAZF,EAaEC,uBAbF,EAcEC,OAdF,EAeEC,cAfF,EAgBEC,eAhBF,EAiBEC,uBAjBF,EAkBEC,wBAlBF,EAmBEC,mBAnBF,EAoBEC,oBApBF,QAqBO,2BArBP;AAsBA,OAAOC,QAAP,MAAqB,uBAArB;AACA,OAAOC,uBAAP,MAAoC,4BAApC;AACA,OAAOC,iBAAP,MAA8B,gCAA9B;AACA,SAASC,qBAAT,QAAsC,yDAAtC;AACA,OAAOC,YAAP,MAAyB,iBAAzB;AACA,OAAOC,KAAP,MAAkB,mBAAlB;AAEA,SACEC,aADF,EAEEC,oBAFF,EAGEC,WAHF,EAIEC,eAJF,EAKEC,iBALF,EAMEC,gBANF,EAOEC,mBAPF,EAQEC,qBARF,EASEC,aATF,EAUEC,gBAVF,EAWEC,qBAXF,EAYEC,aAZF,EAaEC,wBAbF,QAcO,kBAdP;AAeA,SAASC,uBAAT,EAAkCC,wBAAlC,EAA4DC,4BAA5D,EAA0FC,8BAA1F,EAA0HC,sBAA1H,EAAkJC,wBAAlJ,EAA4KC,kBAA5K,QAAsM,oBAAtM;AACA,SAASC,wBAAT,QAAyC,UAAzC;AACA,OAAOC,gBAAP,MAA6B,+BAA7B;AACA,SAASC,iBAAT,EAA4BC,kBAA5B,QAAsD,kBAAtD;AACA,SAASC,4BAAT,QAA6C,cAA7C;AACA,SAASC,WAAT,QAA4B,qBAA5B,C,CAEA;;AACA,MAAMC,gBAAN,SAA+B1D,KAAK,CAAC2D,SAArC,CAA+C;AAC7CC,EAAAA,WAAW,CAACC,KAAD,EAAQ;AACjB,UAAMA,KAAN;;AADiB,uDA0CUC,SAAD,IAAe;AACzC,UAAI,KAAKC,KAAL,CAAWC,OAAX,CAAmBC,MAAnB,KAA8B,CAAlC,EAAqC;AACnC,aAAKC,QAAL,CAAc;AACZF,UAAAA,OAAO,EAAEF,SAAS,CAACK;AADP,SAAd;AAGD;AACF,KAhDkB;;AAAA,+CA2DC,MAAOC,OAAP,IAAmB;AACrC,YAAMC,iBAAiB,GAAG,KAAKC,kBAAL,GAA0BC,GAA1B,CAA8BC,MAAM,IAAIA,MAAM,CAACC,EAA/C,CAA1B;;AACA,UAAI,CAACL,OAAL,EAAc;AACZ,cAAM,KAAKP,KAAL,CAAWa,sBAAX,CAAkCL,iBAAlC,CAAN;AACA,cAAM,KAAKR,KAAL,CAAWc,qBAAX,CAAiC,KAAKL,kBAAL,EAAjC,CAAN;AACA,aAAKJ,QAAL,CAAc;AAAEU,UAAAA,SAAS,EAAE,CAACR;AAAd,SAAd;AACD,OAJD,MAIO;AACL,cAAM,KAAKP,KAAL,CAAWgB,wBAAX,CAAoCR,iBAApC,CAAN;AACA,cAAM,KAAKR,KAAL,CAAWiB,wBAAX,CAAoC,KAAKR,kBAAL,EAApC,CAAN;AACA,aAAKJ,QAAL,CAAc;AAAEU,UAAAA,SAAS,EAAE;AAAb,SAAd;AACD;;AACD,WAAKG,iBAAL;AACD,KAvEkB;;AAAA,gDA6EE,OAAOC,QAAP,EAAiBC,QAAjB,KAA8B;AACjD,YAAM,KAAKpB,KAAL,CAAWqB,wBAAX,CAAoCF,QAApC,CAAN;AACA,YAAM,KAAKnB,KAAL,CAAWsB,kBAAX,CAA8BF,QAA9B,CAAN;AACA,WAAKF,iBAAL;;AACA,UAAI,CAAC,KAAKhB,KAAL,CAAWa,SAAhB,EAA2B;AACzB,aAAKV,QAAL,CAAc;AACZU,UAAAA,SAAS,EAAE;AADC,SAAd;AAGD;AACF,KAtFkB;;AAAA,mDA4FK,OAAOI,QAAP,EAAiBC,QAAjB,KAA8B;AACpD,YAAM,KAAKpB,KAAL,CAAWuB,2BAAX,CAAuCJ,QAAvC,CAAN;AACA,YAAM,KAAKnB,KAAL,CAAWsB,kBAAX,CAA8BF,QAA9B,CAAN;AACA,WAAKF,iBAAL;;AACA,UAAI,KAAKlB,KAAL,CAAWwB,cAAX,CAA0BpB,MAA1B,KAAqC,CAAzC,EAA4C;AAC1C,aAAKC,QAAL,CAAc;AACZU,UAAAA,SAAS,EAAE;AADC,SAAd;AAGD;AACF,KArGkB;;AAAA,+CAwGC,MAAM;AACxB,WAAKV,QAAL,CAAc;AACZoB,QAAAA,cAAc,EAAE,KAAKzB,KAAL,CAAWM,UAAX,CACboB,MADa,CACLf,MAAD,IAAYA,MAAM,CAACgB,QAAP,IAAmBhB,MAAM,CAACiB,SADhC,EAEblB,GAFa,CAERC,MAAD,IAAYA,MAAM,CAACC,EAFV;AADJ,OAAd;AAKD,KA9GkB;;AAAA,yCAgHL,MAAM,KAAKP,QAAL,CAAc;AAAEwB,MAAAA,SAAS,EAAE;AAAb,KAAd,CAhHD;;AAAA,0CAiHJ,MAAM,KAAKxB,QAAL,CAAc;AAAEwB,MAAAA,SAAS,EAAE;AAAb,KAAd,CAjHF;;AAAA,4CAmHF,MAAM,KAAKxB,QAAL,CAAc;AAAEyB,MAAAA,cAAc,EAAE;AAAlB,KAAd,CAnHJ;;AAAA,6CAoHD,MAAM,KAAKzB,QAAL,CAAc;AAAEyB,MAAAA,cAAc,EAAE;AAAlB,KAAd,CApHL;;AAAA,gDAsHE,MAAM,KAAKzB,QAAL,CAAc;AAAE0B,MAAAA,kBAAkB,EAAE;AAAtB,KAAd,CAtHR;;AAAA,iDAuHG,MAAM,KAAK1B,QAAL,CAAc;AAAE0B,MAAAA,kBAAkB,EAAE;AAAtB,KAAd,CAvHT;;AAAA,4CAyHF,MACf,KAAK1B,QAAL,CAAc;AACZ2B,MAAAA,cAAc,EAAE,EADJ;AAEZC,MAAAA,eAAe,EAAE,EAFL;AAGZC,MAAAA,WAAW,EAAE,EAHD;AAIZC,MAAAA,cAAc,EAAE,EAJJ;AAKZC,MAAAA,UAAU,EAAE,EALA;AAMZC,MAAAA,UAAU,EAAE;AANA,KAAd,CA1HiB;;AAAA,uCAkINC,IAAD,IAAU,KAAKjC,QAAL,CAAc;AAAEiC,MAAAA;AAAF,KAAd,CAlIH;;AAAA,gDAmIG3B,MAAD,IAAY,KAAKN,QAAL,CAAc;AAAEgC,MAAAA,UAAU,EAAE1B;AAAd,KAAd,CAnId;;AAAA,kDAoIKe,MAAD,IAAY,KAAKrB,QAAL,CAAc;AAAE,OAACqB,MAAD,GAAU;AAAZ,KAAd,CApIhB;;AAAA,0CAqIHa,IAAD,IAAU,KAAKlC,QAAL,CAAc;AAAEmC,MAAAA,WAAW,EAAED,IAAf;AAAqBE,MAAAA,MAAM,EAAEF;AAA7B,KAAd,CArIN;;AAAA,6CAuIAG,IAAD,IAAU;AAC1B,WAAKrC,QAAL,CAAc;AAAE+B,QAAAA,UAAU,EAAEM;AAAd,OAAd;AACD,KAzIkB;;AAAA,2CA4IFvC,OAAD,IAAa;AAC3B,YAAM;AAAEmC,QAAAA;AAAF,UAAW,KAAKpC,KAAtB;;AACA,cAAQoC,IAAR;AACE,aAAK,kBAAL;AACE,iBAAOnC,OAAO,CAACmC,IAAR,CAAa5F,gBAAb,CAAP;;AACF,aAAK,mBAAL;AACE,iBAAOyD,OAAO,CAACmC,IAAR,CAAa3F,iBAAb,CAAP;;AACF,aAAK,kBAAL;AACE,iBAAOwD,OAAO,CAACmC,IAAR,CAAa1F,gBAAb,CAAP;;AACF,aAAK,iBAAL;AACE,iBAAOuD,OAAO,CAACmC,IAAR,CAAarF,eAAb,CAAP;;AACF,aAAK,gBAAL;AACE,iBAAOkD,OAAO,CAACmC,IAAR,CAAanF,cAAb,CAAP;;AACF,aAAK,mBAAL;AACE,iBAAOgD,OAAO,CAACmC,IAAR,CAAazF,iBAAb,CAAP;;AACF,aAAK,kBAAL;AACE,iBAAOsD,OAAO,CAACmC,IAAR,CAAatF,gBAAb,CAAP;;AACF,aAAK,iBAAL;AACE,iBAAOmD,OAAO,CAACmC,IAAR,CAAapF,eAAb,CAAP;;AACF,aAAK,wBAAL;AACE,iBAAOiD,OAAO,CAACmC,IAAR,CAAalF,sBAAb,CAAP;;AACF,aAAK,yBAAL;AACE,iBAAO+C,OAAO,CAACmC,IAAR,CAAajF,uBAAb,CAAP;;AACF,aAAK,mBAAL;AACE,iBAAO8C,OAAO,CAACmC,IAAR,CAAahF,OAAb,CAAP;;AACF,aAAK,kBAAL;AACE,iBAAO6C,OAAO,CAACmC,IAAR,CAAa7F,gBAAb,CAAP;;AACF,aAAK,gBAAL;AACE,iBAAO0D,OAAO,CAACmC,IAAR,CAAa/E,cAAb,CAAP;;AACF,aAAK,iBAAL;AACE,iBAAO4C,OAAO,CAACmC,IAAR,CAAa9E,eAAb,CAAP;;AACF,aAAK,qBAAL;AACE,iBAAO2C,OAAO,CAACmC,IAAR,CAAavF,mBAAb,CAAP;;AACF,aAAK,sBAAL;AACE,iBAAOoD,OAAO,CAACmC,IAAR,CAAaxF,oBAAb,CAAP;;AACF,aAAK,yBAAL;AACE,iBAAOqD,OAAO,CAACmC,IAAR,CAAa7E,uBAAb,CAAP;;AACF,aAAK,0BAAL;AACE,iBAAO0C,OAAO,CAACmC,IAAR,CAAa5E,wBAAb,CAAP;;AACF,aAAK,qBAAL;AACE,iBAAOyC,OAAO,CAACmC,IAAR,CAAa3E,mBAAb,CAAP;;AACF,aAAK,sBAAL;AACE,iBAAOwC,OAAO,CAACmC,IAAR,CAAa1E,oBAAb,CAAP;;AACF,aAAK,SAAL;AACE,iBAAOuC,OAAO,CAACmC,IAAR,CAAa7F,gBAAb,CAAP;;AACF;AACE;AA5CJ;AA8CD,KA5LkB;;AAAA,iDA6LI0D,OAAD,IAAa,KAAKE,QAAL,CAAc;AAAEsC,MAAAA,cAAc,EAAExC;AAAlB,KAAd,CA7LhB;;AAAA,4CA+LDyC,eAAD,IAAqB;AACpC,YAAM;AAAEP,QAAAA;AAAF,UAAiB,KAAKnC,KAA5B;AACA,aAAO0C,eAAe,CAACC,MAAhB,CAAuB,CAACC,QAAD,EAAWC,aAAX,KAA6B;AACzD,cAAM;AAAEC,UAAAA;AAAF,YAAWD,aAAjB;AACA,cAAME,YAAY,GAAGD,IAAI,CAACE,OAAL,CAAa,KAAb,EAAoB,EAApB,EAAwBC,WAAxB,EAArB;;AACA,YAAIF,YAAY,CAACG,OAAb,CAAqBf,UAAU,CAACc,WAAX,GAAyBD,OAAzB,CAAiC,KAAjC,EAAwC,EAAxC,CAArB,MAAsE,CAAC,CAAvE,IAA4EJ,QAAQ,CAACM,OAAT,CAAiBL,aAAjB,MAAoC,CAAC,CAArH,EAAwH;AACtHD,UAAAA,QAAQ,CAACO,IAAT,CAAcN,aAAd;AACD;;AACD,eAAOD,QAAP;AACD,OAPM,EAOJ,EAPI,CAAP;AAQD,KAzMkB;;AAAA,2CA2MFQ,KAAD,IAAW;AACzB,YAAM;AAAEnD,QAAAA;AAAF,UAAc,KAAKD,KAAzB;AACA,WAAKG,QAAL,CAAekD,SAAD,IAAe;AAC3BA,QAAAA,SAAS,CAACpD,OAAV,CAAkBkD,IAAlB,CAAuBlD,OAAO,CAACmD,KAAD,CAA9B;AACA,eAAO;AAAEnD,UAAAA,OAAO,EAAEoD,SAAS,CAACpD;AAArB,SAAP;AACD,OAHD;AAID,KAjNkB;;AAAA,4CAmNDmD,KAAD,IAAW;AAC1B,YAAM;AAAEnD,QAAAA;AAAF,UAAc,KAAKD,KAAzB;AACA,YAAMsD,eAAe,GAAG,KAAKC,gBAAL,CAAsBtD,OAAtB,EAA+BA,OAAO,CAACmD,KAAD,CAAtC,CAAxB;AACA,WAAKjD,QAAL,CAAc;AAAEF,QAAAA,OAAO,EAAEqD;AAAX,OAAd;AACD,KAvNkB;;AAAA,6CAyNAZ,eAAD,IAAqB;AACrC,YAAM;AACJZ,QAAAA,cADI;AAEJI,QAAAA,UAFI;AAGJsB,QAAAA,kBAHI;AAIJxB,QAAAA;AAJI,UAKF,KAAKhC,KALT;AAMA,YAAM;AAAEyD,QAAAA;AAAF,UAAe,KAAK3D,KAA1B;AACA,UAAIG,OAAO,GAAG,EAAd;;AACA,UAAIuD,kBAAkB,CAACtD,MAAnB,IAA6BsD,kBAAkB,CAACN,OAAnB,CAA2B,KAA3B,MAAsC,CAAC,CAAxE,EAA2E;AACzEjD,QAAAA,OAAO,GAAGyC,eAAe,CAAClB,MAAhB,CAAwBf,MAAD,IAC9BA,MAAM,CAACiD,OAAP,IAAkBjD,MAAM,CAACiD,OAAP,CAAeC,KAAjC,IAA0CH,kBAAkB,CAACN,OAAnB,CAA2BzC,MAAM,CAACiD,OAAP,CAAeC,KAAf,CAAqBV,WAArB,EAA3B,MAAmE,CAAC,CADvG,CAAV;AAGD;;AACD,UAAInB,cAAc,CAAC5B,MAAf,IAAyB4B,cAAc,CAACoB,OAAf,CAAuB,KAAvB,MAAkC,CAAC,CAAhE,EAAmE;AACjEjD,QAAAA,OAAO,GAAGyC,eAAe,CAAClB,MAAhB,CAAwBf,MAAD,IAAY;AAC3C,cAAI,CAACA,MAAM,CAACgD,QAAZ,EAAsB;AACpB,mBAAO3B,cAAc,CAACoB,OAAf,CAAuBO,QAAQ,CAAChD,MAAM,CAACmD,UAAR,CAA/B,MAAwD,CAAC,CAAhE;AACD;;AACD,iBAAO9B,cAAc,CAACoB,OAAf,CAAuBzC,MAAM,CAACgD,QAAP,CAAgBX,IAAvC,MAAiD,CAAC,CAAzD;AACD,SALS,CAAV;AAMD;;AACD,UAAId,WAAW,CAAC9B,MAAZ,IAAsB8B,WAAW,CAACkB,OAAZ,CAAoB,KAApB,MAA+B,CAAC,CAA1D,EAA6D;AAC3DjD,QAAAA,OAAO,GAAGA,OAAO,CAACuB,MAAR,CAAgBf,MAAD,IACtBA,MAAM,CAACoD,QAAP,IAAmBpD,MAAM,CAACoD,QAAP,CAAgBrC,MAAhB,CAAuBsC,OAAO,IAAIA,OAAO,CAACC,WAA1C,EAAuD7D,MAAvD,KAAkE,CAD9E,CAAV;AAGD;;AACD,UAAIgC,UAAU,CAAChC,MAAX,IAAqBgC,UAAU,CAACgB,OAAX,CAAmB,KAAnB,MAA8B,CAAC,CAAxD,EAA2D;AACzDjD,QAAAA,OAAO,GAAGyC,eAAe,CAAClB,MAAhB,CAAwBf,MAAD,IAAY;AAC3C,cAAI,CAACA,MAAM,CAACuD,KAAZ,EAAmB;AACjB,mBAAO9B,UAAU,CAACgB,OAAX,CAAmBzC,MAAM,CAACwD,OAA1B,MAAuC,CAAC,CAA/C;AACD;;AACD,iBAAO/B,UAAU,CAACgB,OAAX,CAAmBzC,MAAM,CAACuD,KAAP,CAAatD,EAAhC,MAAwC,CAAC,CAAhD;AACD,SALS,CAAV;AAMD;;AACD,aAAOT,OAAP;AACD,KA7PkB;;AAAA,gDA+PE,MAAM;AACzB,YAAM;AACJmC,QAAAA,IADI;AAEJF,QAAAA,UAFI;AAGJD,QAAAA,cAHI;AAIJE,QAAAA,UAJI;AAKJL,QAAAA,cALI;AAMJ0B,QAAAA,kBANI;AAOJxB,QAAAA,WAPI;AAQJkC,QAAAA;AARI,UASF,KAAKlE,KATT;;AAUA,UAAIkC,UAAU,KAAKgC,WAAW,CAAChC,UAA3B,IAAyCC,UAAU,KAAK+B,WAAW,CAAC/B,UAAxE,EAAoF;AAClF,cAAM;AAAEgC,UAAAA;AAAF,YAA4B,KAAKrE,KAAvC;AACA,aAAKK,QAAL,CAAc;AAAE+D,UAAAA,WAAW,EAAE;AAAEhC,YAAAA,UAAF;AAAcC,YAAAA;AAAd;AAAf,SAAd;AACAgC,QAAAA,qBAAqB,CAAC;AAAEjC,UAAAA,UAAF;AAAcC,UAAAA;AAAd,SAAD,CAArB;AACD;;AACD,UAAIO,eAAe,GAAG,KAAK5C,KAAL,CAAWM,UAAjC;;AACA,UAAI+B,UAAU,CAACjC,MAAf,EAAuB;AACrBwC,QAAAA,eAAe,GAAG,KAAK0B,cAAL,CAAoB1B,eAApB,CAAlB;AACD;;AACD,UACER,UAAU,CAAChC,MAAX,IACAsD,kBAAkB,CAACtD,MADnB,IAEA4B,cAAc,CAAC5B,MAFf,IAGA8B,WAAW,CAAC9B,MAJd,EAKE;AACAwC,QAAAA,eAAe,GAAG,KAAK2B,eAAL,CAAqB3B,eAArB,CAAlB;AACD;;AACD,UAAIT,cAAc,CAAC/B,MAAnB,EAA2B;AACzBwC,QAAAA,eAAe,GAAG,KAAK4B,aAAL,CAAmB5B,eAAnB,CAAlB;AACD;;AACD,UAAIN,IAAJ,EAAU;AACR,eAAO,CAAC,GAAG,KAAKmC,aAAL,CAAmB7B,eAAnB,CAAJ,CAAP;AACD;;AACD,aAAOA,eAAP;AACD,KAlSkB;;AAAA,2CAsSFA,eAAD,IAAqB;AACnC,YAAM;AAAE8B,QAAAA;AAAF,UAAW,KAAK1E,KAAtB;AACA,YAAM;AAAEmC,QAAAA;AAAF,UAAqB,KAAKjC,KAAhC;AACA,UAAIC,OAAO,GAAGyC,eAAd;;AACA,UAAIT,cAAc,CAAC/B,MAAf,IAAyB+B,cAAc,CAACiB,OAAf,CAAuB,KAAvB,MAAkC,CAAC,CAAhE,EAAmE;AACjE,YAAIjB,cAAc,CAACwC,QAAf,CAAwB,UAAxB,CAAJ,EAAyC;AACvCxE,UAAAA,OAAO,GAAGA,OAAO,CAACuB,MAAR,CAAgBf,MAAD,IAAYA,MAAM,CAACiE,QAAP,KAAoBtI,MAAM,GAAGuI,MAAT,CAAgB,YAAhB,CAA/C,CAAV;AACD;;AACD,YAAI1C,cAAc,CAACwC,QAAf,CAAwB,gBAAxB,CAAJ,EAA+C;AAC7CxE,UAAAA,OAAO,GAAGA,OAAO,CAACuB,MAAR,CAAgBf,MAAD,IACvBrE,MAAM,CAACoI,IAAI,CAACI,WAAN,CAAN,CAAyBC,aAAzB,CAAuCpE,MAAM,CAACrD,OAA9C,EAAuD,KAAvD,CADQ,CAAV;AAGD;;AACD,YAAI6E,cAAc,CAACwC,QAAf,CAAwB,SAAxB,CAAJ,EAAwC;AACtCxE,UAAAA,OAAO,GAAGA,OAAO,CAACuB,MAAR,CAAgBf,MAAD,IAAYA,MAAM,CAACqE,MAAP,KAAkB,SAA7C,CAAV;AACD;;AACD,YAAI7C,cAAc,CAACwC,QAAf,CAAwB,WAAxB,CAAJ,EAA0C;AACxCxE,UAAAA,OAAO,GAAGA,OAAO,CAACuB,MAAR,CAAgBf,MAAD,IAAY,CAACA,MAAM,CAACiE,QAAnC,CAAV;AACD;;AACD,YAAIzC,cAAc,CAACwC,QAAf,CAAwB,YAAxB,CAAJ,EAA2C;AACzCxE,UAAAA,OAAO,GAAGA,OAAO,CAACuB,MAAR,CAAgBf,MAAD,IAAYA,MAAM,CAACqE,MAAP,KAAkB,aAA7C,CAAV;AACD;;AACD,eAAO7E,OAAP;AACD;;AACD,aAAOA,OAAP;AACD,KA/TkB;;AAAA,+CAiUC,CAAC8E,UAAD,EAAavD,MAAb,KAAwB;AAC1C,YAAM;AACJM,QAAAA,cAAc,EAAEkD,qBADZ;AAEJxB,QAAAA,kBAAkB,EAAEyB,yBAFhB;AAGJjD,QAAAA,WAAW,EAAEkD,kBAHT;AAIJjD,QAAAA,cAAc,EAAEkD;AAJZ,UAKF,KAAKnF,KALT;AAMA,UAAIoF,0BAAJ;AACA,UAAIC,kBAAJ;AACA,UAAIC,0BAAJ;;AACA,cAAQP,UAAR;AACE,aAAK,SAAL;AACEK,UAAAA,0BAA0B,GAAGJ,qBAA7B;AACAK,UAAAA,kBAAkB,GAAG,gBAArB;AACA;;AACF,aAAK,OAAL;AACED,UAAAA,0BAA0B,GAAGH,yBAA7B;AACAI,UAAAA,kBAAkB,GAAG,oBAArB;AACA;;AACF,aAAK,OAAL;AACED,UAAAA,0BAA0B,GAAGF,kBAA7B;AACAG,UAAAA,kBAAkB,GAAG,aAArB;AACA;;AACF,aAAK,SAAL;AACED,UAAAA,0BAA0B,GAAGD,qBAA7B;AACAE,UAAAA,kBAAkB,GAAG,gBAArB;AACA;;AACF;AACE;AAlBJ,OAV0C,CA8B1C;;;AACA,UAAID,0BAA0B,CAAClC,OAA3B,CAAmC1B,MAAnC,MAA+C,CAAC,CAApD,EAAuD;AACrD8D,QAAAA,0BAA0B,GAAGnJ,MAAM,CAACiJ,0BAAD,EAA6B;AAC9DG,UAAAA,KAAK,EAAE,CAAC/D,MAAD;AADuD,SAA7B,CAAnC;AAGD,OAJD,MAIO;AACL,cAAMgE,WAAW,GAAGJ,0BAA0B,CAAClC,OAA3B,CAAmC1B,MAAnC,CAApB;AACA8D,QAAAA,0BAA0B,GAAGnJ,MAAM,CAACiJ,0BAAD,EAA6B;AAC9DK,UAAAA,OAAO,EAAE,CAAC,CAACD,WAAD,EAAc,CAAd,CAAD;AADqD,SAA7B,CAAnC;AAGD;;AACD,WAAKrF,QAAL,CAAc;AAAE,SAACkF,kBAAD,GAAsBC;AAAxB,OAAd;AACD,KA3WkB;;AAAA,8CA6WA,CAACI,KAAD,EAAQC,KAAR,KAAkBD,KAAK,CAAClE,MAAN,CAAcf,MAAD,IAAYA,MAAM,KAAKkF,KAApC,CA7WlB;;AAAA,+CA+WC,MAAM;AACxB,YAAM;AAAEpD,QAAAA;AAAF,UAAa,KAAKvC,KAAxB;AACA,YAAM;AAAEwE,QAAAA;AAAF,UAAW,KAAK1E,KAAtB;;AACA,UAAIyC,MAAM,KAAK,MAAf,EAAuB;AACrB,eACE,MAAC,QAAD;AACE,UAAA,IAAI,EAAEiC,IADR;AAEE,UAAA,OAAO,EAAE,KAAKjE,kBAAL,EAFX;AAGE,UAAA,SAAS,EAAE,KAAKP,KAAL,CAAWa,SAHxB;AAIE,UAAA,cAAc,EAAE,KAAK+E,cAJvB;AAKE,UAAA,aAAa,EAAE,KAAKC,aALtB;AAME,UAAA,UAAU,EAAE,KAAKC,iBANnB;AAOE,UAAA,kBAAkB,EAAE,KAAKC,kBAP3B;AAQE,UAAA,qBAAqB,EAAE,KAAKC,qBAR9B;AASE,UAAA,cAAc,EAAE,KAAKhG,KAAL,CAAW4B,cAT7B;AAUE,UAAA,WAAW,EAAE,KAAKqE,WAVpB;AAWE,UAAA,eAAe,EAAE,KAAKC,eAXxB;AAYE,UAAA,cAAc,EAAE,KAAKC,cAZvB;AAaE,UAAA,qBAAqB,EAAErI,qBAbzB;AAcE,UAAA,cAAc,EAAE,KAAKkC,KAAL,CAAWuB,cAd7B;AAeE,UAAA,oBAAoB,EAAE,KAAK6E,oBAf7B;AAgBE,UAAA,qBAAqB,EAAE,KAAKC,qBAhB9B;AAiBE,UAAA,0BAA0B,EAAE,KAAKC,0BAjBnC;AAkBE,UAAA,iBAAiB,EAAE,KAAKtG,KAAL,CAAWuG,iBAlBhC;AAmBE,UAAA,0BAA0B,EAAE,KAAKC,0BAnBnC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,UADF;AAuBD;;AACD,aACE,MAAC,QAAD;AACE,QAAA,IAAI,EAAEhC,IADR;AAEE,QAAA,OAAO,EAAE,KAAKjE,kBAAL,EAFX;AAGE,QAAA,SAAS,EAAE,KAAKkG,SAHlB;AAIE,QAAA,IAAI,EAAE,KAAKzG,KAAL,CAAWoC,IAJnB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QADF;AAQD,KAnZkB;;AAAA,4CAqZDsE,WAAD,IAAiB;AAChC,YAAM;AAAEpF,QAAAA,cAAF;AAAkBqF,QAAAA;AAAlB,UAAkC,KAAK7G,KAA7C,CADgC,CAEhC;;AACA,UAAIwB,cAAc,CAACpB,MAAf,IAAyB,CAA7B,EAAgC,OAAO,IAAP,CAHA,CAIhC;;AACA,YAAM0G,OAAO,GAAG;AACdC,QAAAA,UAAU,EAAE,KAAK/G,KAAL,CAAW0E,IAAX,CAAgB9D,EADd;AAEdoG,QAAAA,UAAU,EAAExF,cAFE;AAGdyF,QAAAA,eAAe,EAAEL,WAAW,CAACM,UAHf;AAIdtC,QAAAA,QAAQ,EAAEgC,WAAW,CAACtJ;AAJR,OAAhB;AAMA,YAAM6J,mBAAmB,GAAGN,WAAW,CAACnF,MAAZ,CAAoBf,MAAD,IAC7Ca,cAAc,CAACmD,QAAf,CAAwBhE,MAAM,CAACiB,SAA/B,CAD0B,CAA5B,CAXgC,CAehC;;AACA,UAAIuF,mBAAmB,CAAC/G,MAApB,GAA6B,CAAjC,EAAoC;AAClC,aAAKgH,kBAAL;AACA,eAAO,KAAK/G,QAAL,CAAc;AACnB8G,UAAAA,mBADmB;AAEnBE,UAAAA,eAAe,EAAEP,OAFE;AAGnBQ,UAAAA,wBAAwB,EAAE;AAHP,SAAd,CAAP;AAKD,OAvB+B,CAwBhC;;;AACA,WAAKC,oBAAL,CAA0BT,OAA1B;AACD,KA/akB;;AAAA,kDAibK3G,OAAD,IAAa;AAClC,YAAM;AACJqH,QAAAA;AADI,UAEF,KAAKxH,KAFT;AAGA,WAAKyH,mBAAL,GAJkC,CAKlC;;AACA,UAAIX,OAAO,GAAG3G,OAAd;;AACA,UAAI,CAAC2G,OAAL,EAAc;AACZA,QAAAA,OAAO,GAAG,KAAK5G,KAAL,CAAWmH,eAArB;AACD;;AACDG,MAAAA,6BAA6B,CAACV,OAAD,CAA7B,CAVkC,CAWlC;;AACA,WAAKP,qBAAL;AACD,KA9bkB;;AAAA,mDAicK,MAAM;AAC5B,YAAM;AACJtF,QAAAA,wBADI;AAEJD,QAAAA;AAFI,UAGF,KAAKhB,KAHT;AAIAgB,MAAAA,wBAAwB,CAAC,KAAKP,kBAAL,EAAD,CAAxB;AACAQ,MAAAA,wBAAwB,CAAC,KAAKR,kBAAL,EAAD,CAAxB;AACA,WAAKJ,QAAL,CAAc;AAAEU,QAAAA,SAAS,EAAE,KAAb;AAAoBoG,QAAAA,mBAAmB,EAAE,EAAzC;AAA6CE,QAAAA,eAAe,EAAE;AAA9D,OAAd;AACD,KAzckB;;AAAA,gDAudE,MAAM;AACzB,YAAM;AAAEK,QAAAA,mBAAF;AAAuBC,QAAAA;AAAvB,UAAgD,KAAK3H,KAA3D;AACA2H,MAAAA,oBAAoB,CAAC,IAAD,CAApB;AACAD,MAAAA,mBAAmB,CAAC,EAAD,CAAnB;AACD,KA3dkB;;AAAA,wDA6dWE,gBAAD,IAAsB;AACjD,YAAM;AAAEC,QAAAA;AAAF,UAAiC,KAAK7H,KAA5C;;AACA,UAAI4H,gBAAgB,IAAIA,gBAAgB,CAACxH,MAAjB,GAA0B,CAAlD,EAAqD;AACnD,aAAKK,kBAAL,GAA0BqH,OAA1B,CAAkCnH,MAAM,IAAI;AAC1C,cAAIiH,gBAAgB,CAACjD,QAAjB,CAA0BhE,MAAM,CAACC,EAAjC,CAAJ,EAA0C;AACxC,gBAAID,MAAM,CAACoD,QAAP,IAAmBpD,MAAM,CAACoD,QAAP,CAAgB3D,MAAhB,GAAyB,CAAhD,EAAmD;AACjDO,cAAAA,MAAM,CAACoD,QAAP,CAAgB+D,OAAhB,CAAwB9D,OAAO,IAAI;AACjC,oBAAIA,OAAO,CAAC+D,WAAR,KAAwB,SAA5B,EAAuC;AACrC,wBAAMjB,OAAO,GAAG;AACdkB,oBAAAA,iBAAiB,EAAErH,MAAM,CAACC,EADZ;AAEdqH,oBAAAA,UAAU,EAAEjE,OAAO,CAACA,OAAR,CAAgBpD,EAFd;AAGdmH,oBAAAA,WAAW,EAAE;AAHC,mBAAhB;AAKAF,kBAAAA,0BAA0B,CAACf,OAAD,CAA1B;AACD;AACF,eATD;AAUD,aAXD,MAWO,IAAInG,MAAM,CAACuH,QAAP,IAAmBvH,MAAM,CAACuH,QAAP,CAAgB9H,MAAhB,GAAyB,CAAhD,EAAmD;AACxD,oBAAM+H,QAAQ,GAAGxI,4BAA4B,CAC3C,KAAKK,KAAL,CAAW0E,IAAX,CAAgB9D,EAD2B,EAE3CD,MAAM,CAACC,EAFoC,EAG3CD,MAAM,CAACuH,QAAP,CAAgB,CAAhB,EAAmBtH,EAHwB,CAA7C;AAKA,oBAAMwH,QAAQ,GAAGzI,4BAA4B,CAC3C,KAAKK,KAAL,CAAW0E,IAAX,CAAgB9D,EAD2B,EAE3CD,MAAM,CAACC,EAFoC,EAG3CD,MAAM,CAACuH,QAAP,CAAgB,CAAhB,EAAmBtH,EAHwB,CAA7C;;AAKA,uBAAQyH,GAAR,CAAY,CAACF,QAAD,EAAWC,QAAX,CAAZ,EAAkCE,IAAlC,CAAwCJ,QAAD,IAAc;AACnD,sBAAMK,gBAAgB,GAAGL,QAAQ,CAACxG,MAAT,CAAiB8G,OAAD,IAAaA,OAA7B,CAAzB;AACAD,gBAAAA,gBAAgB,CAAC7H,GAAjB,CAAsB8H,OAAD,IAAa;AAChCA,kBAAAA,OAAO,CAACC,eAAR,CAAwB/H,GAAxB,CAA6BsD,OAAD,IAAa;AACvC,wBAAIA,OAAO,CAAC+D,WAAR,KAAwB,SAA5B,EAAuC;AACrC,4BAAMjB,OAAO,GAAG;AACdkB,wBAAAA,iBAAiB,EAAErH,MAAM,CAACC,EADZ;AAEdqH,wBAAAA,UAAU,EAAEjE,OAAO,CAACA,OAAR,CAAgBpD,EAFd;AAGdmH,wBAAAA,WAAW,EAAE;AAHC,uBAAhB;AAKAF,sBAAAA,0BAA0B,CAACf,OAAD,CAA1B;AACD;AACF,mBATD;AAUD,iBAXD;AAYD,eAdD;AAeD;AACF;AACF,SAzCD;AA0CA,aAAKzG,QAAL,CAAc;AAAEoG,UAAAA,iBAAiB,EAAE7G,WAAW,CAAC,KAAKM,KAAL,CAAWuG,iBAAZ,EAA+BmB,gBAA/B;AAAhC,SAAd;AACA,aAAKrB,qBAAL;AACD;AACF,KA7gBkB;;AAAA,wDA+gBWmC,aAAD,IAAmB;AAC9C,YAAM;AAAEC,QAAAA;AAAF,UAA8B,KAAK3I,KAAzC;;AACA,UAAI0I,aAAa,IAAIA,aAAa,CAACtI,MAAd,GAAuB,CAA5C,EAA+C;AAC7C,aAAKK,kBAAL,GAA0BqH,OAA1B,CAAkCnH,MAAM,IAAI;AAC1C,cAAI+H,aAAa,CAAC/D,QAAd,CAAuBhE,MAAM,CAACC,EAA9B,CAAJ,EAAuC;AACrC,kBAAMkG,OAAO,GAAG;AACdkB,cAAAA,iBAAiB,EAAErH,MAAM,CAACC,EADZ;AAEdgI,cAAAA,WAAW,EAAE,CAACjI,MAAM,CAACkI;AAFP,aAAhB;AAIAF,YAAAA,uBAAuB,CAAC7B,OAAD,CAAvB;AACD;AACF,SARD,EAD6C,CAU7C;;AACA,aAAKP,qBAAL;AACD;AACF,KA9hBkB;;AAEjB,SAAKrG,KAAL,GAAa;AACX4I,MAAAA,IAAI,EAAE,IADK;AAEX3I,MAAAA,OAAO,EAAE,EAFE;AAGX0B,MAAAA,SAAS,EAAE,KAHA;AAIXW,MAAAA,WAAW,EAAE,MAJF;AAKXC,MAAAA,MAAM,EAAE,MALG;AAMXT,MAAAA,cAAc,EAAE,EANL;AAOX0B,MAAAA,kBAAkB,EAAE,EAPT;AAQXxB,MAAAA,WAAW,EAAE,EARF;AASXC,MAAAA,cAAc,EAAE,EATL;AAUXG,MAAAA,IAAI,EAAE,EAVK;AAWXD,MAAAA,UAAU,EAAE,EAXD;AAYXD,MAAAA,UAAU,EAAE,EAZD;AAaXO,MAAAA,cAAc,EAAE,EAbL;AAcX5B,MAAAA,SAAS,EAAE,KAdA;AAeXe,MAAAA,cAAc,EAAE,KAfL;AAgBXL,MAAAA,cAAc,EAAE,EAhBL;AAiBXM,MAAAA,kBAAkB,EAAE,KAjBT;AAkBXoF,MAAAA,mBAAmB,EAAE,EAlBV;AAmBXE,MAAAA,eAAe,EAAE,EAnBN;AAoBXjD,MAAAA,WAAW,EAAE;AACX/B,QAAAA,UAAU,EAAE,EADD;AAEXD,QAAAA,UAAU,EAAE;AAFD,OApBF;AAwBXkF,MAAAA,wBAAwB,EAAE,EAxBf;AAyBXb,MAAAA,iBAAiB,EAAE;AAzBR,KAAb;AA2BD;;AAEDsC,EAAAA,iBAAiB,GAAG;AAClB,SAAK/I,KAAL,CAAWgJ,oBAAX;AACA,UAAM;AAAEpI,MAAAA;AAAF,QAAS,KAAKZ,KAAL,CAAW0E,IAA1B;AACA,UAAM;AAAEuE,MAAAA;AAAF,QAAmB,KAAKjJ,KAA9B;AACA,UAAMkJ,QAAQ,GAAG;AACftI,MAAAA,EADe;AAEfqI,MAAAA;AAFe,KAAjB;AAIA,SAAKjJ,KAAL,CAAWmJ,2BAAX,CAAuCD,QAAvC;AACD;;AAmaDE,EAAAA,iBAAiB,GAAG;AAClB,WACE,MAAC,KAAD;AACE,MAAA,IAAI,EAAE,KAAKlJ,KAAL,CAAW6B,kBADnB;AAEE,MAAA,SAAS,EAAE,MAAM,KAAKwF,oBAAL,EAFnB;AAGE,MAAA,OAAO,EAAE,KAAKE,mBAHhB;AAIE,MAAA,MAAM,EAAC,eAJT;AAKE,MAAA,IAAI,EAAE,KAAKvH,KAAL,CAAWoH,wBALnB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MADF;AASD;;AA2ED+B,EAAAA,MAAM,GAAG;AACP,UAAM;AACJ7G,MAAAA,WADI;AAEJR,MAAAA,cAFI;AAGJ0B,MAAAA,kBAHI;AAIJxB,MAAAA,WAJI;AAKJC,MAAAA;AALI,QAMF,KAAKjC,KANT;AAQA,UAAM;AACJoJ,MAAAA;AADI,QAEF,KAAKtJ,KAFT;AAGA,WACE,MAAC,KAAD,CAAO,QAAP;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACG,KAAKoJ,iBAAL,EADH,EAGqBE,cAAc,KAAK,aAHxC,GAIM,MAAC,uBAAD;AACE,MAAA,kBAAkB,EAAE,KAAKC,kBAD3B;AAEE,MAAA,IAAI,EAAE,KAAKvJ,KAAL,CAAW0E,IAFnB;AAGE,MAAA,MAAM,EAAE,KAAK1E,KAAL,CAAWwJ,YAHrB;AAIE,MAAA,WAAW,EAAE,KAAKrD,WAJpB;AAKE,MAAA,kBAAkB,EAAE,KAAKF,kBAL3B;AAME,MAAA,eAAe,EAAE,KAAKG,eANxB;AAOE,MAAA,qBAAqB,EAAE,KAAKG,qBAP9B;AAQE,MAAA,0BAA0B,EAAE,KAAKC,0BARnC;AASE,MAAA,iBAAiB,EAAE,KAAKtG,KAAL,CAAWuG,iBAThC;AAUE,MAAA,0BAA0B,EAAE,KAAKC,0BAVnC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAJN,GAiBqB4C,cAAc,KAAK,cAjBxC,GAkBM,MAAC,YAAD;AACE,MAAA,kBAAkB,EAAE,KAAKC,kBAD3B;AAEE,MAAA,IAAI,EAAE,KAAKvJ,KAAL,CAAW0E,IAFnB;AAGE,MAAA,MAAM,EAAE,KAAK1E,KAAL,CAAWwJ,YAHrB;AAIE,MAAA,WAAW,EAAE,KAAKrD,WAJpB;AAKE,MAAA,kBAAkB,EAAE,KAAKF,kBAL3B;AAME,MAAA,eAAe,EAAE,KAAKG,eANxB;AAOE,MAAA,qBAAqB,EAAE,KAAKG,qBAP9B;AAQE,MAAA,0BAA0B,EAAE,KAAKC,0BARnC;AASE,MAAA,0BAA0B,EAAE,KAAKE,0BATnC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAlBN,IA+BM,MAAC,aAAD;AACE,MAAA,WAAW,EAAElE,WADf;AAEE,MAAA,YAAY,EAAE,KAAKiH,YAFrB;AAGE,MAAA,cAAc,EAAE,KAAKC,cAHvB;AAIE,MAAA,kBAAkB,EAAE,KAAKC,kBAJ3B;AAKE,MAAA,oBAAoB,EAAE,KAAKC,oBAL7B;AAME,MAAA,SAAS,EAAE,KAAKjD,SANlB;AAOE,MAAA,cAAc,EAAE3E,cAPlB;AAQE,MAAA,kBAAkB,EAAE0B,kBARtB;AASE,MAAA,WAAW,EAAExB,WATf;AAUE,MAAA,cAAc,EAAEC,cAVlB;AAWE,MAAA,iBAAiB,EAAE,KAAK0H,iBAX1B;AAYE,MAAA,eAAe,EAAE,KAAKC,eAZxB;AAaE,MAAA,aAAa,EAAE,KAAKtF,aAbtB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MA/BN,EA8CO,KAAKuF,iBAAL,EA9CP,EA+CM,MAAC,gBAAD;AACE,MAAA,IAAI,EAAE,KAAK7J,KAAL,CAAW2B,SADnB,CAEE;AAFF;AAGE,MAAA,OAAO,EAAE,KAAK7B,KAAL,CAAWM,UAHtB;AAIE,MAAA,iBAAiB,EAAE,KAAK0J,YAJ1B;AAKE,MAAA,mBAAmB,EAAE,KAAKC,mBAL5B;AAME,MAAA,cAAc,EAAE,KAAKC,cAAL,CAAoBC,IAApB,CAAyB,IAAzB,CANlB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MA/CN,EAuDM;AACE,MAAA,IAAI,EAAC,GADP;AAEE,MAAA,OAAO,EAAE,KAAKhE,WAFhB;AAGE,MAAA,SAAS,EAAC,mDAHZ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OAKE;AAAG,MAAA,SAAS,EAAC,gBAAb;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,aALF,kBAvDN,EADF;AAmED;;AAhnB4C;;AAmnB/CtG,gBAAgB,CAACuK,SAAjB,GAA6B;AAC3B1F,EAAAA,IAAI,EAAEtI,SAAS,CAACiO,MAAV,CAAiBC,UADI;AAE3Bd,EAAAA,YAAY,EAAEpN,SAAS,CAACiO,MAFG;AAG3BE,EAAAA,qBAAqB,EAAEnO,SAAS,CAACoO,IAAV,CAAeF;AAHX,CAA7B;;AAMA,MAAMG,kBAAkB,GAAIC,QAAD,KAAe;AACxC1B,EAAAA,oBAAoB,EAAE9M,kBAAkB,CAACiC,aAAD,EAAgBuM,QAAhB,CADA;AAExCvB,EAAAA,2BAA2B,EAAEjN,kBAAkB,CAACkC,oBAAD,EAAuBsM,QAAvB,CAFP;AAGxCpJ,EAAAA,kBAAkB,EAAEpF,kBAAkB,CAACmC,WAAD,EAAcqM,QAAd,CAHE;AAIxC7J,EAAAA,sBAAsB,EAAE3E,kBAAkB,CAACoC,eAAD,EAAkBoM,QAAlB,CAJF;AAKxC1J,EAAAA,wBAAwB,EAAE9E,kBAAkB,CAACqC,iBAAD,EAAoBmM,QAApB,CALJ;AAMxCrJ,EAAAA,wBAAwB,EAAEnF,kBAAkB,CAACsC,gBAAD,EAAmBkM,QAAnB,CANJ;AAOxCnJ,EAAAA,2BAA2B,EAAErF,kBAAkB,CAACuC,mBAAD,EAAsBiM,QAAtB,CAPP;AAQxClD,EAAAA,6BAA6B,EAAEtL,kBAAkB,CAACwC,qBAAD,EAAwBgM,QAAxB,CART;AASxC5J,EAAAA,qBAAqB,EAAE5E,kBAAkB,CAACyC,aAAD,EAAgB+L,QAAhB,CATD;AAUxCzJ,EAAAA,wBAAwB,EAAE/E,kBAAkB,CAAC0C,gBAAD,EAAmB8L,QAAnB,CAVJ;AAWxChD,EAAAA,mBAAmB,EAAExL,kBAAkB,CAACuD,iBAAD,EAAoBiL,QAApB,CAXC;AAYxC/C,EAAAA,oBAAoB,EAAEzL,kBAAkB,CAACwD,kBAAD,EAAqBgL,QAArB,CAZA;AAaxC/B,EAAAA,uBAAuB,EAAEzM,kBAAkB,CAAC2C,qBAAD,EAAwB6L,QAAxB,CAbH;AAcxCrG,EAAAA,qBAAqB,EAAEnI,kBAAkB,CAAC4C,aAAD,EAAgB4L,QAAhB,CAdD;AAexC7C,EAAAA,0BAA0B,EAAE3L,kBAAkB,CAAC6C,wBAAD,EAA2B2L,QAA3B;AAfN,CAAf,CAA3B;;AAkBA,MAAMC,eAAe,GAAGpL,wBAAwB,CAAC;AAC/Ce,EAAAA,UAAU,EAAEtB,uBAAuB,EADY;AAE/C6H,EAAAA,WAAW,EAAE1H,8BAA8B,EAFI;AAG/CqC,EAAAA,cAAc,EAAEvC,wBAAwB,EAHO;AAI/CgK,EAAAA,YAAY,EAAE/J,4BAA4B,EAJK;AAK/CsK,EAAAA,YAAY,EAAEpK,sBAAsB,EALW;AAM/CkK,EAAAA,cAAc,EAAEjK,wBAAwB,EANO;AAO/CsE,EAAAA,QAAQ,EAAErE,kBAAkB;AAPmB,CAAD,CAAhD;AAUA,eAAerD,OAAO,CAAC0O,eAAD,EAAkBF,kBAAlB,CAAP,CAA6C5K,gBAA7C,CAAf","sourcesContent":["/* eslint-disable react/no-did-mount-set-state */\n/* eslint-disable react/no-did-update-set-state */\n/* eslint-disable react/no-array-index-key */\nimport { connect } from \"react-redux\";\nimport { bindActionCreators } from \"redux\";\n\nimport React from \"react\";\nimport PropTypes from \"prop-types\";\nimport update from \"immutability-helper\";\nimport moment from \"moment\";\nimport FilterSection from \"./components/FilterSection\";\nimport FullView from \"./components/FullView\";\nimport {\n  dueDateAscending,\n  subjectAscending,\n  subjectDescending,\n  passageAscending,\n  passageDescending,\n  lessonNameDescending,\n  lessonNameAscending,\n  statusDescending,\n  statusAscending,\n  scoreDescending,\n  scoreAscending,\n  availableDateAscending,\n  availableDateDescending,\n  dueDate,\n  flagsAscending,\n  flagsDescending,\n  completionDateAscending,\n  completionDateDescending,\n  lessonTypeAscending,\n  lessonTypeDescending,\n} from \"../../utils/sortFunctions\";\nimport ListView from \"./components/ListView\";\nimport LessonDetailAnswerSheet from \"../LessonDetailAnswerSheet\";\nimport AssignLessonModal from \"./components/AssignLessonModal\";\nimport { renderDropdownOptions } from './components/FullView/components/LessonCard/utils/index';\nimport ReadWorkBook from '../ReadWorkBook';\nimport Modal from \"../../Modal/index\";\n\nimport {\n  getLessonList,\n  getStudentLessonList,\n  checkLesson,\n  checkAllLessons,\n  unCheckAllLessons,\n  addCheckedLesson,\n  removeCheckedLesson,\n  assignLessonToStudent,\n  addAllLessons,\n  removeAllLessons,\n  excuseStudentLateness,\n  filterLessons,\n  flagStudentLessonProblem,\n} from \"../index/actions\";\nimport { makeSelectGetLessonList, makeSelectCheckedLessons, makeSelectActiveStudentToken, makeSelectGetStudentLessonList, makeSelectActiveLesson, makeSelectOpenActivePage, makeSelectSubjects } from \"../index/selectors\";\nimport { createStructuredSelector } from \"reselect\";\nimport AssignDatesModal from \"./components/AssignDatesModal\";\nimport { setOpenActivePage, setIsVisibleTopBar } from \"../index/actions\";\nimport { fetchStudentLessonSectionApi } from \"../index/api\";\nimport { mergeArrays } from './utils/mergeArrays';\n\n// TODO: compare updatedlessons to lessons and update lesson list\nclass DetailLessonList extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      test: true,\n      lessons: [],\n      modalOpen: false,\n      currentView: \"full\",\n      active: \"full\",\n      subjectFilters: [],\n      scoreStatusFilters: [],\n      flagFilters: [],\n      dueDateFilters: [],\n      sort: \"\",\n      nameFilter: \"\",\n      unitFilter: \"\",\n      updatedLessons: [],\n      selectAll: false,\n      dropdownIsOpen: false,\n      checkedCardIds: [],\n      isConfirmModalOpen: false,\n      prevAssignedLessons: [],\n      lessonsToAssign: {},\n      prevFilters: {\n        nameFilter: '',\n        unitFilter: '',\n      },\n      confirmationModalMessage: '',\n      lessonIdsToUnFlag: [],\n    };\n  }\n\n  componentDidMount() {\n    this.props.dispathGetLessonList();\n    const { id } = this.props.user;\n    const { studentToken } = this.props;\n    const postBody = {\n      id,\n      studentToken,\n    };\n    this.props.dispathGetStudentLessonList(postBody);\n  }\n\n  componentWillReceiveProps = (nextProps) => {\n    if (this.state.lessons.length === 0) {\n      this.setState({\n        lessons: nextProps.lessonList,\n      });\n    }\n  };\n\n  // deSelectAllLessons = async (selectedLessonIds) => {\n  //   await this.props.dispatchUnCheckAllLesson(selectedLessonIds);\n  //   await this.props.dispatchRemoveAllLessons(this.getMappableLessons());\n  //   this.setState({ selectAll: false });\n  // }\n\n  /**\n   * @param checked {bool}\n   */\n  onCheckAllClicked = async (checked) => {\n    const selectedLessonIds = this.getMappableLessons().map(lesson => lesson.id);\n    if (!checked) {\n      await this.props.dispatchCheckAllLesson(selectedLessonIds);\n      await this.props.dispatchAddAllLessons(this.getMappableLessons());\n      this.setState({ selectAll: !checked });\n    } else {\n      await this.props.dispatchUnCheckAllLesson(selectedLessonIds);\n      await this.props.dispatchRemoveAllLessons(this.getMappableLessons());\n      this.setState({ selectAll: false });\n    }\n    this.setCheckedCardIds();\n  };\n\n  /**\n   * @param lessonId {string}\n   * @param uniqueId {string}\n   */\n  onAddCheckedLesson = async (lessonId, uniqueId) => {\n    await this.props.dispatchAddCheckedLesson(lessonId);\n    await this.props.dispathCheckLesson(uniqueId);\n    this.setCheckedCardIds();\n    if (!this.state.selectAll) {\n      this.setState({\n        selectAll: true,\n      });\n    }\n  };\n\n  /**\n   * @param lessonId {string}\n   * @param uniqueId {string}\n   */\n  onRemoveCheckedLesson = async (lessonId, uniqueId) => {\n    await this.props.dispatchRemoveCheckedLesson(lessonId);\n    await this.props.dispathCheckLesson(uniqueId);\n    this.setCheckedCardIds();\n    if (this.props.checkedLessons.length === 0) {\n      this.setState({\n        selectAll: false,\n      });\n    }\n  };\n\n  // This updates the selected ASSIGNED student lessons in local state\n  setCheckedCardIds = () => {\n    this.setState({\n      checkedCardIds: this.props.lessonList\n        .filter((lesson) => lesson.selected && lesson.lesson_id)\n        .map((lesson) => lesson.id),\n    });\n  };\n\n  onOpenModal = () => this.setState({ modalOpen: true });\n  onCloseModal = () => this.setState({ modalOpen: false });\n\n  onOpenDropdown = () => this.setState({ dropdownIsOpen: true });\n  onCloseDropdown = () => this.setState({ dropdownIsOpen: false });\n\n  onOpenConfirmModal = () => this.setState({ isConfirmModalOpen: true });\n  onCloseConfirmModal = () => this.setState({ isConfirmModalOpen: false });\n\n  onClearFilters = () =>\n    this.setState({\n      subjectFilters: [],\n      completeFilters: [],\n      flagFilters: [],\n      dueDateFilters: [],\n      unitFilter: \"\",\n      nameFilter: \"\",\n    });\n  onSetSort = (sort) => this.setState({ sort });\n  onSetFilteredState = (lesson) => this.setState({ nameFilter: lesson });\n  onUnsetFilteredState = (filter) => this.setState({ [filter]: \"\" });\n  onChangeView = (view) => this.setState({ currentView: view, active: view });\n\n  onSetUnitFilter = (unit) => {\n    this.setState({ unitFilter: unit });\n  };\n\n  // eslint-disable-next-line consistent-return\n  onSortLessons = (lessons) => {\n    const { sort } = this.state;\n    switch (sort) {\n      case \"subjectAscending\":\n        return lessons.sort(subjectAscending);\n      case \"subjectDescending\":\n        return lessons.sort(subjectDescending);\n      case \"passageAscending\":\n        return lessons.sort(passageAscending);\n      case \"statusAscending\":\n        return lessons.sort(statusAscending);\n      case \"scoreAscending\":\n        return lessons.sort(scoreAscending);\n      case \"passageDescending\":\n        return lessons.sort(passageDescending);\n      case \"statusDescending\":\n        return lessons.sort(statusDescending);\n      case \"scoreDescending\":\n        return lessons.sort(scoreDescending);\n      case \"availableDateAscending\":\n        return lessons.sort(availableDateAscending);\n      case \"availableDateDescending\":\n        return lessons.sort(availableDateDescending);\n      case \"dueDateDescending\":\n        return lessons.sort(dueDate);\n      case \"dueDateAscending\":\n        return lessons.sort(dueDateAscending);\n      case \"flagsAscending\":\n        return lessons.sort(flagsAscending);\n      case \"flagsDescending\":\n        return lessons.sort(flagsDescending);\n      case \"lessonNameAscending\":\n        return lessons.sort(lessonNameAscending);\n      case \"lessonNameDescending\":\n        return lessons.sort(lessonNameDescending);\n      case \"completionDateAscending\":\n        return lessons.sort(completionDateAscending);\n      case \"completionDateDescending\":\n        return lessons.sort(completionDateDescending);\n      case \"lessonTypeAscending\":\n        return lessons.sort(lessonTypeAscending);\n      case \"lessonTypeDescending\":\n        return lessons.sort(lessonTypeDescending);\n      case \"dueDate\":\n        return lessons.sort(dueDateAscending);\n      default:\n        break;\n    }\n  };\n  onAddUpdatedLessons = (lessons) => this.setState({ updatedLessons: lessons });\n\n  onFilterByName = (mappableLessons) => {\n    const { nameFilter } = this.state;\n    return mappableLessons.reduce((finalArr, currentLesson) => {\n      const { name } = currentLesson;\n      const lessonString = name.replace(/\\s/g, \"\").toLowerCase();\n      if (lessonString.indexOf(nameFilter.toLowerCase().replace(/\\s/g, '')) !== -1 && finalArr.indexOf(currentLesson) === -1) {\n        finalArr.push(currentLesson);\n      }\n      return finalArr;\n    }, []);\n  };\n\n  onCloneLesson = (index) => {\n    const { lessons } = this.state;\n    this.setState((prevState) => {\n      prevState.lessons.push(lessons[index]);\n      return { lessons: prevState.lessons };\n    });\n  };\n\n  onDeleteLesson = (index) => {\n    const { lessons } = this.state;\n    const newLessonsArray = this.arrayItemRemover(lessons, lessons[index]);\n    this.setState({ lessons: newLessonsArray });\n  };\n  // note: unassigned and incomplete are filtering opposite, but this works for some reason\n  onFilterLessons = (mappableLessons) => {\n    const {\n      subjectFilters,\n      unitFilter,\n      scoreStatusFilters,\n      flagFilters,\n    } = this.state;\n    const { subjects } = this.props;\n    let lessons = [];\n    if (scoreStatusFilters.length && scoreStatusFilters.indexOf(\"all\") === -1) {\n      lessons = mappableLessons.filter((lesson) =>\n        (lesson.scoring && lesson.scoring.grade && scoreStatusFilters.indexOf(lesson.scoring.grade.toLowerCase()) !== -1),\n      );\n    }\n    if (subjectFilters.length && subjectFilters.indexOf(\"all\") === -1) {\n      lessons = mappableLessons.filter((lesson) => {\n        if (!lesson.subjects) {\n          return subjectFilters.indexOf(subjects[lesson.subject_id]) !== -1;\n        }\n        return subjectFilters.indexOf(lesson.subjects.name) !== -1;\n      });\n    }\n    if (flagFilters.length && flagFilters.indexOf(\"all\") === -1) {\n      lessons = lessons.filter((lesson) =>\n        (lesson.problems && lesson.problems.filter(problem => problem.flat_status).length !== 0),\n      );\n    }\n    if (unitFilter.length && unitFilter.indexOf(\"all\") === -1) {\n      lessons = mappableLessons.filter((lesson) => {\n        if (!lesson.units) {\n          return unitFilter.indexOf(lesson.unit_id) !== -1;\n        }\n        return unitFilter.indexOf(lesson.units.id) !== -1;\n      });\n    }\n    return lessons;\n  };\n\n  getMappableLessons = () => {\n    const {\n      sort,\n      unitFilter,\n      dueDateFilters,\n      nameFilter,\n      subjectFilters,\n      scoreStatusFilters,\n      flagFilters,\n      prevFilters,\n    } = this.state;\n    if (unitFilter !== prevFilters.unitFilter || nameFilter !== prevFilters.nameFilter) {\n      const { dispatchFilterLessons } = this.props;\n      this.setState({ prevFilters: { unitFilter, nameFilter } });\n      dispatchFilterLessons({ unitFilter, nameFilter });\n    }\n    let mappableLessons = this.props.lessonList;\n    if (nameFilter.length) {\n      mappableLessons = this.onFilterByName(mappableLessons);\n    }\n    if (\n      unitFilter.length ||\n      scoreStatusFilters.length ||\n      subjectFilters.length ||\n      flagFilters.length\n    ) {\n      mappableLessons = this.onFilterLessons(mappableLessons);\n    }\n    if (dueDateFilters.length) {\n      mappableLessons = this.filterDueDate(mappableLessons);\n    }\n    if (sort) {\n      return [...this.onSortLessons(mappableLessons)];\n    }\n    return mappableLessons;\n  };\n\n  // may need to alter dueNextSession depending if client wants ALL vs incomplete/overdue\n  // TODO: only works with one due date filter, not multiple\n  filterDueDate = (mappableLessons) => {\n    const { user } = this.props;\n    const { dueDateFilters } = this.state;\n    let lessons = mappableLessons;\n    if (dueDateFilters.length && dueDateFilters.indexOf(\"all\") === -1) {\n      if (dueDateFilters.includes(\"dueToday\")) {\n        lessons = lessons.filter((lesson) => lesson.due_date === moment().format(\"YYYY-MM-DD\"));\n      }\n      if (dueDateFilters.includes(\"dueNextSession\")) {\n        lessons = lessons.filter((lesson) =>\n          moment(user.nextSession).isSameOrAfter(lesson.dueDate, \"day\"),\n        );\n      }\n      if (dueDateFilters.includes(\"overdue\")) {\n        lessons = lessons.filter((lesson) => lesson.status === 'OVERDUE');\n      }\n      if (dueDateFilters.includes(\"noDueDate\")) {\n        lessons = lessons.filter((lesson) => !lesson.due_date);\n      }\n      if (dueDateFilters.includes(\"unAssigned\")) {\n        lessons = lessons.filter((lesson) => lesson.status === \"NOTASSIGNED\");\n      }\n      return lessons;\n    }\n    return lessons;\n  };\n\n  handleFilterClick = (filterType, filter) => {\n    const {\n      subjectFilters: currentSubjectFilters,\n      scoreStatusFilters: currentScoreStatusFilters,\n      flagFilters: currentFlagFilters,\n      dueDateFilters: currentDueDateFilters,\n    } = this.state;\n    let modifiedFilterCurrentState;\n    let modifiedFilterName;\n    let modifiedFilterUpdatedState;\n    switch (filterType) {\n      case \"subject\":\n        modifiedFilterCurrentState = currentSubjectFilters;\n        modifiedFilterName = \"subjectFilters\";\n        break;\n      case \"score\":\n        modifiedFilterCurrentState = currentScoreStatusFilters;\n        modifiedFilterName = \"scoreStatusFilters\";\n        break;\n      case \"flags\":\n        modifiedFilterCurrentState = currentFlagFilters;\n        modifiedFilterName = \"flagFilters\";\n        break;\n      case \"dueDate\":\n        modifiedFilterCurrentState = currentDueDateFilters;\n        modifiedFilterName = \"dueDateFilters\";\n        break;\n      default:\n        break;\n    }\n    // Decide whether we're adding or removing the selected filter\n    if (modifiedFilterCurrentState.indexOf(filter) === -1) {\n      modifiedFilterUpdatedState = update(modifiedFilterCurrentState, {\n        $push: [filter],\n      });\n    } else {\n      const filterIndex = modifiedFilterCurrentState.indexOf(filter);\n      modifiedFilterUpdatedState = update(modifiedFilterCurrentState, {\n        $splice: [[filterIndex, 1]],\n      });\n    }\n    this.setState({ [modifiedFilterName]: modifiedFilterUpdatedState });\n  };\n\n  arrayItemRemover = (array, value) => array.filter((lesson) => lesson !== value);\n\n  renderCurrentView = () => {\n    const { active } = this.state;\n    const { user } = this.props;\n    if (active === \"full\") {\n      return (\n        <FullView\n          user={user}\n          lessons={this.getMappableLessons()}\n          selectAll={this.state.selectAll}\n          onDeleteLesson={this.onDeleteLesson}\n          onCloneLesson={this.onCloneLesson}\n          onCheckAll={this.onCheckAllClicked}\n          onAddCheckedLesson={this.onAddCheckedLesson}\n          onRemoveCheckedLesson={this.onRemoveCheckedLesson}\n          dropdownIsOpen={this.state.dropdownIsOpen}\n          onOpenModal={this.onOpenModal}\n          onCloseDropdown={this.onCloseDropdown}\n          onOpenDropdown={this.onOpenDropdown}\n          renderDropdownOptions={renderDropdownOptions}\n          checkedCardIds={this.state.checkedCardIds}\n          onAddAssignLessonIds={this.onAddAssignLessonIds}\n          resetLessonSelections={this.resetLessonSelections}\n          handleMarkAllFlagsReviewed={this.handleMarkAllFlagsReviewed}\n          lessonIdsToUnFlag={this.state.lessonIdsToUnFlag}\n          handleExcuseLessonLateness={this.handleExcuseLessonLateness}\n        />\n      );\n    }\n    return (\n      <ListView\n        user={user}\n        lessons={this.getMappableLessons()}\n        onSetSort={this.onSetSort}\n        sort={this.state.sort}\n      />\n    );\n  };\n\n  onAssignLesson = (lessonDates) => {\n    const { checkedLessons, studentLess } = this.props;\n    // Check if there are lessons to assign\n    if (checkedLessons.length <= 0) return null;\n    // Check if that lesson has already been assigned\n    const payload = {\n      student_id: this.props.user.id,\n      lesson_ids: checkedLessons,\n      assignment_date: lessonDates.assignDate,\n      due_date: lessonDates.dueDate,\n    };\n    const prevAssignedLessons = studentLess.filter((lesson) =>\n      checkedLessons.includes(lesson.lesson_id),\n    );\n\n    // If lessons have been assigned before, open modal\n    if (prevAssignedLessons.length > 0) {\n      this.onOpenConfirmModal();\n      return this.setState({\n        prevAssignedLessons,\n        lessonsToAssign: payload,\n        confirmationModalMessage: 'One or more lessons you are assigning to this student have previously been assigned. Assign Lessons anyways?',\n      });\n    }\n    // Move onto sending request\n    this.submitAssignedLesson(payload);\n  }\n\n  submitAssignedLesson = (lessons) => {\n    const {\n      dispatchAssignLessonToStudent,\n    } = this.props;\n    this.onCloseConfirmModal();\n    // Dispatch assign lesson to student\n    let payload = lessons;\n    if (!payload) {\n      payload = this.state.lessonsToAssign;\n    }\n    dispatchAssignLessonToStudent(payload);\n    // Clear the redux checkedLesson property\n    this.resetLessonSelections();\n  }\n\n  // Resets redux store, unchecks lessons, resets checked state\n  resetLessonSelections = () => {\n    const {\n      dispatchRemoveAllLessons,\n      dispatchUnCheckAllLesson,\n    } = this.props;\n    dispatchUnCheckAllLesson(this.getMappableLessons());\n    dispatchRemoveAllLessons(this.getMappableLessons());\n    this.setState({ selectAll: false, prevAssignedLessons: [], lessonsToAssign: {} });\n  }\n\n  confirmationModal() {\n    return (\n      <Modal\n        open={this.state.isConfirmModalOpen}\n        onConfirm={() => this.submitAssignedLesson()}\n        onClose={this.onCloseConfirmModal}\n        header=\"Are you sure?\"\n        body={this.state.confirmationModalMessage}\n      />\n    );\n  }\n\n  onCloseDetailModal = () => {\n    const { onSetOpenActivePage, onSetIsVisibleTopBar } = this.props;\n    onSetIsVisibleTopBar(true);\n    onSetOpenActivePage(\"\");\n  }\n\n  handleMarkAllFlagsReviewed = (studentLessonIds) => {\n    const { onFlagStudentLessonProblem } = this.props;\n    if (studentLessonIds && studentLessonIds.length > 0) {\n      this.getMappableLessons().forEach(lesson => {\n        if (studentLessonIds.includes(lesson.id)) {\n          if (lesson.problems && lesson.problems.length > 0) {\n            lesson.problems.forEach(problem => {\n              if (problem.flag_status === \"FLAGGED\") {\n                const payload = {\n                  student_lesson_id: lesson.id,\n                  problem_id: problem.problem.id,\n                  flag_status: 'REVIEWED',\n                };\n                onFlagStudentLessonProblem(payload);\n              }\n            });\n          } else if (lesson.sections && lesson.sections.length > 0) {\n            const section1 = fetchStudentLessonSectionApi(\n              this.props.user.id,\n              lesson.id,\n              lesson.sections[0].id,\n            );\n            const section2 = fetchStudentLessonSectionApi(\n              this.props.user.id,\n              lesson.id,\n              lesson.sections[1].id,\n            );\n            Promise.all([section1, section2]).then((sections) => {\n              const filteredSections = sections.filter((section) => section);\n              filteredSections.map((section) => {\n                section.lesson_problems.map((problem) => {\n                  if (problem.flag_status === \"FLAGGED\") {\n                    const payload = {\n                      student_lesson_id: lesson.id,\n                      problem_id: problem.problem.id,\n                      flag_status: 'REVIEWED',\n                    };\n                    onFlagStudentLessonProblem(payload);\n                  }\n                });\n              });\n            });\n          }\n        }\n      });\n      this.setState({ lessonIdsToUnFlag: mergeArrays(this.state.lessonIdsToUnFlag, studentLessonIds) });\n      this.resetLessonSelections();\n    }\n  }\n\n  handleExcuseLessonLateness = (lessonCardIds) => {\n    const { onExcuseStudentLateness } = this.props;\n    if (lessonCardIds && lessonCardIds.length > 0) {\n      this.getMappableLessons().forEach(lesson => {\n        if (lessonCardIds.includes(lesson.id)) {\n          const payload = {\n            student_lesson_id: lesson.id,\n            was_excused: !lesson.lateness_excused,\n          };\n          onExcuseStudentLateness(payload);\n        }\n      });\n      // Deselect all checks and lessons\n      this.resetLessonSelections();\n    }\n  }\n\n  render() {\n    const {\n      currentView,\n      subjectFilters,\n      scoreStatusFilters,\n      flagFilters,\n      dueDateFilters,\n    } = this.state;\n\n    const {\n      activeShowPage,\n    } = this.props;\n    return (\n      <React.Fragment>\n        {this.confirmationModal()}\n        <Choose>\n          <When condition={activeShowPage === \"AnswerSheet\"}>\n            <LessonDetailAnswerSheet\n              onCloseDetailModal={this.onCloseDetailModal}\n              user={this.props.user}\n              lesson={this.props.activeLesson}\n              onOpenModal={this.onOpenModal}\n              onAddCheckedLesson={this.onAddCheckedLesson}\n              onCloseDropdown={this.onCloseDropdown}\n              resetLessonSelections={this.resetLessonSelections}\n              handleMarkAllFlagsReviewed={this.handleMarkAllFlagsReviewed}\n              lessonIdsToUnFlag={this.state.lessonIdsToUnFlag}\n              handleExcuseLessonLateness={this.handleExcuseLessonLateness}\n            />\n          </When>\n          <When condition={activeShowPage === \"ReadWorkBook\"}>\n            <ReadWorkBook\n              onCloseDetailModal={this.onCloseDetailModal}\n              user={this.props.user}\n              lesson={this.props.activeLesson}\n              onOpenModal={this.onOpenModal}\n              onAddCheckedLesson={this.onAddCheckedLesson}\n              onCloseDropdown={this.onCloseDropdown}\n              resetLessonSelections={this.resetLessonSelections}\n              handleMarkAllFlagsReviewed={this.handleMarkAllFlagsReviewed}\n              handleExcuseLessonLateness={this.handleExcuseLessonLateness}\n            />\n          </When>\n          <Otherwise>\n            <FilterSection\n              currentView={currentView}\n              onChangeView={this.onChangeView}\n              onClearFilters={this.onClearFilters}\n              onSetFilteredState={this.onSetFilteredState}\n              onUnsetFilteredState={this.onUnsetFilteredState}\n              onSetSort={this.onSetSort}\n              subjectFilters={subjectFilters}\n              scoreStatusFilters={scoreStatusFilters}\n              flagFilters={flagFilters}\n              dueDateFilters={dueDateFilters}\n              handleFilterClick={this.handleFilterClick}\n              onSetUnitFilter={this.onSetUnitFilter}\n              filterDueDate={this.filterDueDate}\n            />\n            {this.renderCurrentView()}\n            <AssignDatesModal\n              open={this.state.modalOpen}\n              // lessons={this.props.user.lessons}\n              lessons={this.props.lessonList}\n              onCloseDatesModal={this.onCloseModal}\n              onAddUpdatedLessons={this.onAddUpdatedLessons}\n              onAssignLesson={this.onAssignLesson.bind(this)}\n            />\n            <a\n              href=\"#\"\n              onClick={this.onOpenModal}\n              className=\"waves-effect waves-teal btn add-btn modal-trigger\"\n            >\n              <i className=\"material-icons\">add</i>Assign Lesson\n            </a>\n          </Otherwise>\n        </Choose>\n      </React.Fragment>\n    );\n  }\n}\n\nDetailLessonList.propTypes = {\n  user: PropTypes.object.isRequired,\n  activeLesson: PropTypes.object,\n  openAnswerSheetStatus: PropTypes.bool.isRequired,\n};\n\nconst mapDispatchToProps = (dispatch) => ({\n  dispathGetLessonList: bindActionCreators(getLessonList, dispatch),\n  dispathGetStudentLessonList: bindActionCreators(getStudentLessonList, dispatch),\n  dispathCheckLesson: bindActionCreators(checkLesson, dispatch),\n  dispatchCheckAllLesson: bindActionCreators(checkAllLessons, dispatch),\n  dispatchUnCheckAllLesson: bindActionCreators(unCheckAllLessons, dispatch),\n  dispatchAddCheckedLesson: bindActionCreators(addCheckedLesson, dispatch),\n  dispatchRemoveCheckedLesson: bindActionCreators(removeCheckedLesson, dispatch),\n  dispatchAssignLessonToStudent: bindActionCreators(assignLessonToStudent, dispatch),\n  dispatchAddAllLessons: bindActionCreators(addAllLessons, dispatch),\n  dispatchRemoveAllLessons: bindActionCreators(removeAllLessons, dispatch),\n  onSetOpenActivePage: bindActionCreators(setOpenActivePage, dispatch),\n  onSetIsVisibleTopBar: bindActionCreators(setIsVisibleTopBar, dispatch),\n  onExcuseStudentLateness: bindActionCreators(excuseStudentLateness, dispatch),\n  dispatchFilterLessons: bindActionCreators(filterLessons, dispatch),\n  onFlagStudentLessonProblem: bindActionCreators(flagStudentLessonProblem, dispatch),\n});\n\nconst mapStateToProps = createStructuredSelector({\n  lessonList: makeSelectGetLessonList(),\n  studentLess: makeSelectGetStudentLessonList(),\n  checkedLessons: makeSelectCheckedLessons(),\n  studentToken: makeSelectActiveStudentToken(),\n  activeLesson: makeSelectActiveLesson(),\n  activeShowPage: makeSelectOpenActivePage(),\n  subjects: makeSelectSubjects(),\n});\n\nexport default connect(mapStateToProps, mapDispatchToProps)(DetailLessonList);\n"]},"metadata":{},"sourceType":"module"}